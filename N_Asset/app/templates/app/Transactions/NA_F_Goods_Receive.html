{% extends "../../app/layout.html" %}
{% block SearchData %}
{% for itemCombo in populateColumn %}
<li><a href="#" data-tipe="{{itemCombo.dataType}}" data-column="{{itemCombo.columnName}}">{{itemCombo.label}}</a></li>
{% endfor %}

t>

{% endblock %}

{% block javascriptAndUI %}
<!--================================Load Script Modules NA ===========================================-->
<script type="text/javascript" src="../../../static/app/scripts/NAJS.js"></script>
<!--=======================================================================================================-->

<script type="text/javascript">
    
	(function(){ 

	    if (!NA.common.getElementID('CustomSearch')) {
	        var parentC = NA.common.doc.querySelector('ul.dropdown-menu.search');
	        lastLi = NA.common.doc.createElement('li'),
			lastLi_a = NA.common.doc.createElement('a');
	        lastLi_a.setAttribute('id', 'custSearch');
	        lastLi_a.textContent = 'CustomSearch';
	        lastLi.appendChild(lastLi_a);
	        parentC.appendChild(lastLi);
	    }
//=================add Dynamic Styles=============================
        NA.common.loadStyles("../../../static/app/content/jquery-ui.min.css","jqueryUI");
        NA.common.loadStyles("../../../static/app/content/ui.jqgrid.css","UIJqueryGrid");   
        var doc = doc||window.document;
        var DivSearch = doc.querySelector('ul.dropdown-menu.search');//return list Element
        (function(elm){
            var listElem = elm.children;
            Array.prototype.forEach.call(listElem,function(item){//buat jadi foreach mesti convert dulu ke array
                NA.NAEvent.addHandler(item, 'click', function (event) {
                    event.preventDefault();
                    if (item.firstChild.id === 'custSearch') {
                        //=========='show dialog search'==================
                        //NA.common.dialog.createSearchDialog(event)
                    }
                    NA.common.getElementID('bySearch').firstChild.nodeValue = item.textContent;
                });
            });
        })(DivSearch);
    })();   
</script>


<!--SETUP Jquery grid-->
<!-- The jQuery library is a prerequisite for all jqSuite products -->
<script>window.jQuery || NA.common.doc.write('\<script src\=\"\.\.\/\.\.\/\.\.\/static\/app\/scripts\/jquery\-1\.11\.1\.js\"\>\<\/script\>');</script>

<!-- This is the Javascript file of jqGrid -->
<script src="../../../static/app/scripts/jquery.jqGrid.js"></script>

<!-- This is the localization file of the grid controlling messages, labels, etc. -->
<!-- We support more than 40 localizations -->
<script src="../../../static/app/scripts/jqGridJS/i18n/grid.locale-en.js"></script>
<!----------------------------Load Jquery UI. JS file-------------------------------->
<script src="../../../static/app/scripts/jquery-ui.js"></script>
<script type="text/javascript">if (typeof $.fn.modal == 'undefined') { NA.common.doc.write('\<script src\=\"\.\.\/\.\.\/\.\.\/static\/app\/scripts\/bootstrap\.js\"\>\<\/script\>'); }</script>
<script src="../../../static/app/scripts/bootstrap-dialog.js"></script>
{% endblock %}

{%block content-0 %}
<table id="jqGrid_NA_F_Goods_Receive"></table>
<div id="jqGrid_NA_F_Goods_Receive_Pager"></div>

{%endblock%}

{% block DialogEntry %}
<script type="text/javascript">
	//=================================AJAX Setup===========================-->

	(function () {
		$.ajaxSetup({
			cache: false,
			error: function (xhr, status, error) {
				try {
					var messageErr = xhr.responseText;
					var contentype = xhr.getResponseHeader('Content-Type')
					if (contentype === 'application/json') {
						messageErr = $.parseJSON(xhr.responseText);
					}
					var message = xhr.responseText;
					if (messageErr) {
						message = messageErr.message;
					}
					if (message) {
						alert('An error occurred: ' + error + '\n' + xhr.status + ": " + message);
					}

				} catch (e) {
					alert('An error occurred: ' + error + '\n' + xhr.status + ": " + e.message);
				}
				window.document.body.style.cursor = 'defautl'; return false;
			},
			timeout: 2000000, // Timeout// nanti kalau sudah selesai system timeout ini harus di rubah, jadi maximal 20 detik
			type: 'GET',
			crossDomain: false, // obviates need for sameOrigin test                              
		});

		//===================================END AJAX SetuP===========================--> 

		//========================Variable Object untuk ===============================
		var win = win || window,
        grid = $("#jqGrid_NA_F_Goods_Receive"),
        txtSearchMaster = txtSearchMaster || NA.common.doc.querySelector('form.navbar-form div.input-group input[name="q"]'),
        btnSearchMaster = btnSearchMaster || NA.common.doc.querySelector('form.navbar-form button[type="submit"].btn.btn-default'),
        status = status || win.status, csrftoken = function () { return NA.CookieUtil.get('csrftoken'); }, initializeForm = '',
        //settings btn sesuai user access
        //anggap saja sekarang admin
        btnSave = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(4)'),
        btnDelete = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(5)'),
        btnExport = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(6)'),
        btnPrint = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(7)'),
        btnHelp = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(8)'),
        containerMenu = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav');//inistialisasi menu 

		window.onunload = function () {
			if (typeof txtSearchMaster.onclick == "function") {
				NA.NAEvent.removeHandler(txtSearchMaster, 'keydown', handlerSearchInput)
			}
			if (typeof btnSearchMaster.onclick == "function") {
				NA.NAEvent.removeHandler(btnSearchMaster, 'click', handlerSearchInput);
			}
		};
		function LoadData(page) {
			var url = 'NA_Goods_Receive_Search/?' + win.encodeURIComponent('columnName') + '=' + win.encodeURIComponent(NA.common.SearchData.getColumnKey()) +
                      '&' + win.encodeURIComponent('valueKey') + '=' + win.encodeURIComponent(NA.common.SearchData.getValueKey()) +
                      '&' + win.encodeURIComponent('dataType') + '=' + win.encodeURIComponent(NA.common.SearchData.getDataType()) +
                      '&' + win.encodeURIComponent('criteria') + '=' + win.encodeURIComponent(NA.common.SearchData.getCriteria());
			if (arguments.length > 0) {
				grid.setGridParam({ url: url }).trigger("reloadGrid", [{ page: page, }]);
			}
			else {
				try {
					grid.jqGrid({
						url: url,
						mtype: "GET",
						datatype: "json",//#column IDapp  no	goods 	datereceived supliername FK_ReceivedBy 	receivedby FK_P_R_By pr_by totalpurchase totalreceived,CreatedDate, CreatedBy 
						colNames: ['idapp', 'NO', 'goods name', 'Date Received', 'Suplier Name', 'FK_ReceivedBy', 'Received By', 'FK_P_R_By ', 'Purchase Request By', 'Total Purchased', 'Total Received','Descriptions', 'Created Date', 'Created By'],
						colModel: [
                            { name: 'idapp', key: true, hidden: true, align: 'left' },
                            { name: 'NO', width: 40, align: 'right', sortable: false, editable: false, },
                            { name: 'goods', index: 'goods', width: 120, sortable: true, editable: false, align: 'left', },
                            { name: 'datereceived', index: 'datereceived', sortable: true, width: 120, formatter: 'date', formatoptions: { srcformat: 'Y-m-d', newformat: 'd F Y' } },
                            { name: 'supliername', index: 'supliername', width: 150, sortable: true, editable: false, align: 'left', },
                            //formatter : 'date', formatoptions: { srcformat : 'Y-m-d H:i:s', newformat :'ShortDate'}},
                            { name: 'FK_ReceivedBy', index: 'FK_ReceivedBy', hidden: true, },
                            { name: 'receivedby', index: 'receivedby', width: 120, sortable: true, editable: false, align: 'left', },
                            { name: 'FK_P_R_By', index: 'FK_ReceivedBy', hidden: true, },
                            { name: 'pr_by', index: 'pr_by', width: 120, sortable: true, editable: false, align: 'left', },
                            {
                            	name: 'totalpurchase', index: 'totalpurchase', width: 100, sortable: true, align: 'right',                             	
                            },
                            {
                            	name: 'totalreceived', index: 'totalreceived', width: 100, sortable: true, align: 'right',
                            },
							{ name: 'descriptions', index: 'descriptions', width: 120, sortable: true, editable: false, align: 'left', },
                            { name: 'createddate', index: 'CreatedDate', sortable: true, width: 120, formatter: 'date', formatoptions: { srcformat: 'Y-m-d', newformat: 'd F Y' } },
                            { name: 'reatedby', index: 'CreatedBy', sortable: true, width: 110, editable: false, },
						],
						ondblClickRow: function (rowId) {
							var btnOpen = NA.common.doc.querySelector('ul.nav.navbar-nav>li:nth-child(2)>button');
							if (btnOpen) {
								btnOpen.click();
							}
						},
						gridComplete: function () {
							document.body.style.cursor = 'default';
						},
						cellEdit: false,
						viewrecords: true,
						height: $('div.fltlft').height() - ($('div.fltlft').height() * 0.173),
						rowNum: 300,
						rowList: [20, 50, 100, 200, 300, 500],
						sortname: "idapp",
						sortorder: "desc",
						multiSort: true,
						shrinkToFit: false,
						iconSet: "fontAwesome",
						forceFit: true,
						toolbar: true,
						scrollrows: true,
						hidegrid: true,
						caption: "Transactions ---Goods Received",
						pager: "#jqGrid_NA_F_Goods_Receive_Pager"
					});
					grid.navGrid("#jqGrid_NA_F_Goods_Receive_Pager", {
						search: false, // show search button on the toolbar
						add: false,
						edit: false,
						del: false,
						refresh: true
					});

				} catch (e) {
					alert(e.message);
					console.log(e);
					document.body.style.cursor = 'default';
				};
			};
		};

		var SearchData = NA.common.SearchData;
		SearchData.setDefaultSearchData('goods', 'varchar', 'like');
		LoadData();

		NA.common.doc.title = 'Entry Data Goods Receive';
		//disablekan save dan help karena saat ini tidak di pakai
		btnSave.setAttribute('disable', true);
		btnHelp.setAttribute('disable', true);
		NA.common.loadStyles("../../../static/app/content/Dialog.css", "DialogEntryStyle");//Load Style buat dialog sebelum di pakai
		NA.common.loadStyles("../../../static/app/content/NA_commonEntry.css", "CommonEntry");//Load Style buat form sebelum di pakai
		NA.common.dialog.initDialog(containerMenu, 'Nufarm Entry Goods Receive - Transactions');//inistialisasi menu     

		//====================GROUP FUNCTION DECLARATION===============================

		function getValuesForm() {
			//idapp,fk_goods, idapp_fk_goods,goods_desc,datereceived, fk_suplier,supliername, totalpurchase, totalreceived, idapp_fk_received, fk_receivedby,employee_received,idapp_fk_p_r_by, fk_p_r_by,employee_pr, descriptions	
			var elidapp = NA.common.getElementID('id_idapp'),
				idapp = elidapp.value;
			var elidapp_fk_goods = NA.common.getElementID('id_idapp_fk_goods'),
				idapp_fk_goods = elidapp_fk_goods.value;
			var elfk_goods = NA.common.getElementID('id_fk_goods'),
				fk_goods = elfk_goods.value;
			var elgoods_desc = NA.common.getElementID('id_goods_desc'),
				goods_desc = elgoods_desc.value;
			var eldatereceived = NA.common.getElementID('id_datereceived'),
				datereceived = eldatereceived.value.toString().trim();
			var elfk_suplier = NA.common.getElementID('id_fk_suplier'),
				fk_suplier = elfk_suplier.value;
			var elsupliername = NA.common.getElementID('id_supliername'),
				supliername = elsupliername.value;
			var eltotalpurchase = NA.common.getElementID('id_totalpurchase'),
				totalpurchase = eltotalpurchase.value;
			var eltotalreceived = NA.common.getElementID('id_totalreceived'),
				totalreceived = eltotalreceived.value;
			var elidapp_fk_p_r_by = NA.common.getElementID('id_idapp_fk_p_r_by'),
				idapp_fk_p_r_by = elidapp_fk_p_r_by.value;
			var elfk_p_r_by = NA.common.getElementID('id_fk_p_r_by'),
				fk_p_r_by = elfk_p_r_by.value;
			var elemployee_pr = NA.common.getElementID('id_employee_pr'),
				employee_pr = elemployee_pr.value;
			var elidapp_fk_receivedby = NA.common.getElementID('id_idapp_fk_receivedby'),
				idapp_fk_receivedby = elidapp_fk_receivedby.value;
			var elfk_receivedby =  NA.common.getElementID('id_fk_receivedby'),
				fk_receivedby = elfk_receivedby.value;
			var elemployee_received = NA.common.getElementID('id_employee_received'),
				employee_received = elemployee_received.value;
			var eldescriptions = NA.common.getElementID('id_descriptions'),
				descriptions = eldescriptions.value;
			var status = window.status||NA.common.getElementID('id_status').value,
				hasRefData = NA.common.getElementID('id_hasRefData').value;
			var eldescBySystem = NA.common.getElementID('id_descbysystem'),
				descbysystem = eldescBySystem.value;
			return {
				idapp:idapp,
				idapp_fk_goods: idapp_fk_goods,
				fk_goods: fk_goods,
				goods_desc:goods_desc,
				datereceived: datereceived,
				fk_suplier: fk_suplier,
				supliername:supliername,
				totalpurchase: totalpurchase,
				totalreceived: totalreceived,
				idapp_fk_p_r_by: idapp_fk_p_r_by,
				fk_p_r_by: fk_p_r_by,
				employee_pr:employee_pr,
				idapp_fk_receivedby: idapp_fk_receivedby,
				fk_receivedby: fk_receivedby,
				employee_received:employee_received,
				descriptions: descriptions,
				status: status,
				hasRef: hasRefData,
				descbysystem : descbysystem
			};
		};
		function getGridCellValue(thegrid,CeltoGet) {
			var reccount = thegrid.jqGrid('getGridParam', 'reccount');
			var rowId, rowData, colData;
			if (reccount > 0) {
				rowId = thegrid.jqGrid('getGridParam', 'selrow');
				if (rowId) {
					rowData = thegrid.getRowData(rowId);
					colData = rowData[CeltoGet];
				}
			}
			return colData;
		};
		//csrf token untuk form
		function csrfSafeMethod(method) {
			// these HTTP methods do not require CSRF protection
			return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
		};
		function XhrError(xhr) {
			try {
				var messageErr = xhr.responseText;
				var contentype = xhr.getResponseHeader('Content-Type')
				if (contentype === 'application/json') {
					messageErr = JSON.parse(xhr.responseText);
				}
				var message = xhr.responseText;
				if (messageErr) {
					message = messageErr.message;
				}
				if (message) {
					alert('An error occurred: ' + message);
				}
				document.body.style.cursor = 'default';
			} catch (e) {
				alert('An error occurred: ' + e + '\n' + e.message);
				document.body.style.cursor = 'default';
			}
			return false;
		};
		function ExecuteHandler(TextElement) {
			try {

				if (window.document.body.style.cursor != 'wait') { window.document.body.style.cursor = 'wait'; }
				var dialog = NA.common.dialog.doc.querySelector("div.containerDialog");
				var frmEntry = NA.common.getElementID('frm-NA-Entry-Goods_Receive');
				switch (TextElement) {
					case 'OK': {
						if (!frmEntry.checkValidity()) {
							//NA.NAEvent.preventDefault(event);                                          
							var inputbtn = NA.common.getElementID('inputButton');
							inputbtn.click();
						}
						else {
							//check existing
							var elfk_goods = NA.common.getElementID('id_fk_goods'),
								fk_goods = elfk_goods.value;
							var eldatereceived = NA.common.getElementID('id_datereceived'),
								datereceived = eldatereceived.value.toString().trim();
							var eltotalpurchase = NA.common.getElementID('id_totalpurchase'),
								totalPurchase = eltotalpurchase.value;
							var NAAjax = NA.common.AJAX;
							//POST: function (url, data, dataType, MIMEType, OnAJAXStart, OnBeforeSend, OnLoad, OnProgress, OnError, OnLoadEnd, customRequestHeader) {
							NAAjax.POST('HasExists/',
								{ 'fk_goods': fk_goods, 'datereceived': datereceived, 'totalpurchase': totalPurchase },
								'application/json',
								'application/json',
								function () {
									window.document.body.style.cursor = 'wait';
								}, null,
								function () {
									if (this.status === '200') {
										var confirmText = JSON.parse(this.responseText);
										return BootstrapDialog.confirm({
										    title: NA.common.mesage.titleInfo,
										    message: NA.common.mesage.dataHasChanged,
										    type: BootstrapDialog.TYPE_WARNING, // <-- Default value is BootstrapDialog.TYPE_PRIMARY
										    animate: false,
										    closable: false, // <-- Default value is false
										    draggable: true, // <-- Default value is false
										    btnCancelLabel: 'NO.', // <-- Default value is 'Cancel',
										    btnOKLabel: 'Yes.', // <-- Default value is 'OK',
										    btnOKClass: 'btn-success', // <-- If you didn't specify it, dialog type will be used,
										    callback: function (result) {
										        // result will be true if button was click, while it will be false if users close the dialog directly.
										        if (result) {
										            if (!frmEntry.checkValidity()) {
										                var inputbtn = NA.common.getElementID('inputButton');
										                inputbtn.click();
										            }
										            else {
										                if (submitForm()) {
										                	//clear kan semua data
										                	//reset menjadi seperti original value
															
										                	//for (var member in myObject) delete myObject[member]
										                }
										            }
										        }
										        else {
										        	return false;
										        }
										    }
										});
									}
								}, null, function () { XhrError(this); throw new Error('') },
								function () { document.body.style.cursor = 'default'; }, null
							);
						}
						break;
					}
					case 'Cancel':
					case 'Close': {
						//check if data has changed with javascrispt
						initializeForm = NA.common.getElementID('id_initializeForm');
						if (status === 'Open' || initializeForm.Value == '') { NA.common.dialog.closeDialog(dialog); return false; }
						var originalData = JSON.parse(initializeForm.Value);
						var valuesForm = getValuesForm();
						if (NA.common.detectInputChanges(originalData, valuesForm)) {
							return BootstrapDialog.confirm({
								title: NA.common.mesage.titleInfo,
								message: NA.common.mesage.dataHasChanged,
								type: BootstrapDialog.TYPE_WARNING, // <-- Default value is BootstrapDialog.TYPE_PRIMARY
                                animate:false,
								closable: false, // <-- Default value is false
								draggable: true, // <-- Default value is false
								btnCancelLabel: 'NO.', // <-- Default value is 'Cancel',
								btnOKLabel: 'Yes.', // <-- Default value is 'OK',
								btnOKClass: 'btn-success', // <-- If you didn't specify it, dialog type will be used,
								callback: function (result) {
									// result will be true if button was click, while it will be false if users close the dialog directly.
									if (result) {
										if (!frmEntry.checkValidity()) {
											var inputbtn = NA.common.getElementID('inputButton');
											inputbtn.click();
										}
										else {
											if (submitForm()) {
												NA.common.dialog.closeDialog(dialog);
											}
										}
									}
									else {
										NA.common.dialog.closeDialog(dialog);
									}
								}
							});											
						}
						else {
							NA.common.dialog.closeDialog(dialog);
						}						
						document.body.style.cursor = 'default';
						break;
					}
				};
			} catch (e) {
				return false;
			}
			document.body.style.cursor = 'default';
			return true;
		};
		function formatDate(date) {
		    var d = new Date(date),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();

		    if (month.length < 2) month = '0' + month;
		    if (day.length < 2) day = '0' + day;

		    return [year, month, day].join('-');
		}
		function submitForm() {
			//var valuesForm = JSON.stringify(getValuesForm());
			var valuesForm = getValuesForm();
			//valuesForm['status'] = status || $('input[name="status"]').val();
			valuesForm['csrfmiddlewaretoken'] = (function () {
				var el = document.getElementsByName("csrfmiddlewaretoken");
				return el[0].getAttribute("value");
			})();
			var FDate = $('#id_datereceived').val(); FDate = $.datepicker.parseDate('dd/mm/yy', FDate);
			CDate = formatDate(FDate);

			valuesForm['datereceived'] = CDate;
			var NAAjax = NA.common.AJAX;
			//POST: function (url, data, dataType, MIMEType, OnAJAXStart, OnBeforeSend, OnLoad, OnProgress, OnError, OnLoadEnd, customRequestHeader) {
			NAAjax.POST('ShowEntry_Receive', JSON.stringify(valuesForm), 'application/x-www-form-urlencoded', 'application/json',
				function () {
					window.document.body.style.cursor = 'wait';
				},
				null,
				function (e) {
					if (this.statusText == "success") {
						if (grid) {
							grid.trigger("reloadGrid", [{ page: 1 }])
							return true;
						}
						//reloadJquery$("#jqGrid_NA_F_Goods").trigger("reloadGrid", [{ page: 1 }]);
					}
					else {//error berarti
						XhrError(this); document.body.style.cursor = 'default'; throw new Error('')
					}
					document.body.style.cursor = 'default';
				}, null,
				function(e){XhrError(this);throw new Error('')},
				function (e) {
					window.document.body.style.cursor = 'default';
				});
			//$.post("ShowEntry_Receive", valuesForm, function (data, status) {
			//	//reload jqueryGrid
			//	if (data.message === 'success') {
			//		var dialog = NA.common.dialog.doc.querySelector("div.containerDialog");
			//		NA.common.dialog.closeDialog(dialog);
			//		EraseElHidden();
			//		//reload jqueryGrid                        
			//		$("#jqGrid_NA_F_Goods").trigger("reloadGrid", [{ page: 1 }]);
			//		document.body.style.cursor = 'default';
			//		return false;
			//	}
			//});
			return false;
		};

		//atur tampilan form searching entry
		function restyleBoostrapDialog() {
			var BSDialogContent = NA.common.doc.querySelector('div.modal-dialog.modal-sm >.modal-content');
			BSDialogContent.style.cssText = 'width: 440px; height: 330px;';
			var ContentBody = NA.common.doc.querySelector('div.modal-dialog.modal-sm >.modal-content>.modal-body');
			ContentBody.style.cssText = 'padding:0px;';
			var contentFooter = NA.common.doc.querySelector('div.modal-dialog.modal-sm >.modal-content>.modal-footer');
			contentFooter.style.cssText = 'padding-bottom:0px;padding-top:0px;';
			var mHeader = NA.common.doc.querySelector('div.bootstrap-dialog .modal-header.bootstrap-dialog-draggable');
			mHeader.style.cssText = 'height:30px;padding:0px;';
			var footerButton = NA.common.doc.querySelector('div.bootstrap-dialog-footer-buttons');
			footerButton.style.cssText = 'padding-top:8px;';
		};

		function getAllSelectOptions() {
		}

		//========================END GROUP FUNCTION DECLARATION===================================
        
		//=======================GROUP FUNCTION EVENT=============================================
		function printToPDF(event) {
			if (event) {
				NA.NAEvent.preventDefault(event);
				var target = NA.NAEvent.getTarget(event);
				grid.jqGrid("exportToPdf", {
					title: 'Transactions -- goods Received',
					orientation: 'portrait',
					pageSize: 'A4',
					description: 'description of the exported document',
					customSettings: null,
					download: 'download',
					includeLabels: true,
					includeGroupHeader: true,
					includeFooter: true,
					fileName: "goods_Received.pdf"
					//langsung print by pdf file
				});
			}
		};

		function ExporttoExcel(event) {
			if (event) {
				NA.NAEvent.preventDefault(event);
				grid.jqGrid("exportToExcel", {
					includeLabels: true,
					includeGroupHeader: true,
					includeFooter: true,
					fileName: "goods_Received.xlsx",
					maxlength: 40 // maxlength for visible string data 
				});
				NA.NAEvent.stopPropagation(event);
			}
		};
		//set eventKeyboard di search textbox
		function handlerSearchInput(event) {
			event = NA.NAEvent.getEvent(event);
			if (event.keyCode === 13 || event.target == btnSearchMaster) {
				NA.NAEvent.preventDefault(event);
				var elSearch = NA.common.doc.querySelector('li.dropdown>a#bySearch'),
                SearchBy = NA.common.doc.querySelector('li.dropdown>a#bySearch').textContent.trim();
				if (SearchBy.trim() == 'By') {
					SearchData.setDefaultSearchData('goods', 'varchar', 'like');
					var curPage = parseInt(grid.getGridParam('page'));
					window.document.body.style.cursor = 'wait';
					if (event.target.value !== '') {
						NA.common.SearchData.setValue(event.target.value);
					}
					LoadData(curPage);
				}
				else {
					//submit search
					submitSearch(event);
				}
				NA.NAEvent.stopPropagation(event);
			}
			window.document.body.style.cursor = '';
		};
		function submitSearch(event) {
			window.document.body.style.cursor = 'wait';
			if (event)
				NA.NAEvent.preventDefault(event);

			var elementOption = null, columnKey = '', valueKey = '',
            elCriteria = null,//NA.common.doc.querySelector('td.columns select.selectopts.NA-Form-Control option:checked');
            valCriteria = '',//elCriteria.nodeValue;
            elDataType = '';//elementOption.dataset.dataType;
			//get  ajax with querystring search
			//valueKey : valueKey,
			//columnKey :columnKey,
			//dataType : dataType,
			//criteria : criteria,
			if (event.target.getAttribute('id') === 'fbox_jqGrid_search' || event.target.getAttribute('id') === 'jqg1') {//fbox_jqGrid_search == button search,jqg1 = txtSearch nya
				elementOption = NA.common.doc.querySelector('td.columns select.NA-Form-Control option:checked');
				columnKey = elementOption.getAttribute('name'), valueKey = NA.common.getElementID('jqg1').value;
				elCriteria = NA.common.doc.querySelector('td.operators select.selectopts.NA-Form-Control option:checked');
				criteria = elCriteria.value;
				switch (valCriteria) {
					case "eq": { criteria = 'equal'; break; }
					case "ne": { criteria = 'not equal'; break; }
					case "bw": { criteria = 'beginwith'; break; }
					case "ew": { criteria = "endwith"; break; }
					case "cn": { criteria = "contains"; break; }
					case "in": { criteria = "in"; break; }
					case "ni": { criteria = "notin"; break; }
					case "gt": { criteria = "Greater"; break; }
					case "le": { criteria = "less"; break; }
					case "leq": { criteria = "lessorequal"; break; }
					case "gtq": { criteria = "greaterorequal"; break; }
					case "bw": { criteria = "between"; break; }
				};
				elDataType = elementOption.dataset.tipe;
			}
			else if (event.target == txtSearchMaster || event.target == btnSearchMaster) {
				var txtSearchMaster = txtSearchMaster || NA.common.doc.querySelector('form.navbar-form div.input-group input[name="q"]'),
                elSearch = null;
				valueKey = txtSearchMaster.value.trim();
				var listElem = NA.common.doc.querySelector('ul.dropdown-menu.search').children;//return list Element
				var textToSearch = NA.common.getElementID('bySearch').firstChild.nodeValue;
				Array.prototype.forEach.call(listElem, function (item) {//buat jadi foreach mesti convert dulu ke array                   
					if (item.firstChild.textContent === textToSearch) {
						elSearch = item.firstChild;
					}
				});
				columnKey = elSearch.dataset.column
				elDataType = elSearch.dataset.tipe;
				criteria = 'like'
				if (!elSearch.dataset.column) {
					switch (elDataType) {
						case "bigint":
						case "integer":
						case "money":
						case "float":
						case "decimal":
						case "boolean":
						case "datetime": {
							if (valueKey.toString().indexOf(',') > -1) {
								criteria = 'in'
							}
							criteria = 'equal';
							break;
						}
					};
				}
			};

			SearchData.setValue(valueKey);
			SearchData.setColumnName(columnKey);
			SearchData.setDataType(elDataType)
			SearchData.setCriteria(valCriteria);
			window.document.body.style.cursor = 'wait';
			LoadData(1);
			document.body.style.cursor = 'default';
			//grid.setGridParam.trigger("reloadGrid",[{page:1}]);//karena searching harus di set ke page 1
		};

		//function untuk Reset
		function submitReset(event) {
			window.document.body.style.cursor = 'wait';
			SearchData.setDefaultSearchData('goods', 'varchar', 'like');
			SearchData.setValue('');
			LoadData(1);
			window.document.body.style.cursor = 'default';
		};	

		function deletegridDetail(e) {
		    {
		        //var rowid = parseInt($(this).attr("id"));
		        var rowId = gridTbl.jqGrid('getGridParam', 'selrow');
		        if (e.keyCode == 46) {
		            var btnDelete = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(5)')
		            btnDelete.click();
		            return false;
		        }
		    }
		};
		//=======================END GROUP FUNCTION EVENT========================================

		//=======================GROUP ASSINGED HANDLER ========================================= 
		//assign delete key event
		grid.on("keyup", "tr", function (e) {
			//var rowid = parseInt($(this).attr("id"));
			var rowId = grid.jqGrid('getGridParam', 'selrow');
			if (e.keyCode == 46) {
				var btnDelete = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(5)')
				btnDelete.click();
				return false;
			}
		});

		//=======================handler txt & button Search master keyboard event and click================================        
		NA.NAEvent.addHandler(txtSearchMaster, 'keydown', handlerSearchInput);
		NA.NAEvent.addHandler(btnSearchMaster, 'click', handlerSearchInput);
		//=========================================================================================     

		NA.NAEvent.addHandler(btnDelete, 'click', function (event) {
			var idapp = getGridCellValue(grid,'idapp');
			if (idapp) {
				NA.NAEvent.preventDefault(event);
				if (!confirm('are you sure you want to delete data\nOperation can not be undone ?')) {
					return false;
				}
				NA.NAEvent.preventDefault(event);
				try {
					//delete data di server                  
					//$(selector).post(URL,data,function(data,status,xhr),dataType)-->return data type

					var url = NA.common.addURLParam('Delete/', 'idapp', idapp);
					var NAAjax = NA.common.AJAX;
					NAAjax.POST(url,
						{ 'idapp': idapp },
						'application/json',
						'application/json',
						null, null,
						function () {
							var textStatus = JSON.parse(this.responseText);
							if (textStatus === 'success') {
							 var rowNum = grid.getGridParam('rowNum'),
							 allRecords = grid.getGridParam('records'),
							 totalPages = parseInt((allRecords / rowNum) + 1),
							 curPage = grid.getGridParam('page'),
							 rowId = grid.jqGrid('getGridParam', 'selrow'),
								curRecount = grid.jqGrid('getGridParam', 'reccount');
								mustReload = true;
								if (parseInt(curRecount) === 1) {
									if (totalPages > 1) {
										curPage--;
									}
									else {
										mustReload = false;
										grid.delRowData(rowId);
									}
								}
								else if (parseInt(totalPages) === 1) {
									mustReload = false;
									grid.delRowData(rowId);
								}
								else if (parseInt(curRecount) > 1) {
									mustReload = false;
									grid.delRowData(rowId);
								}
								if (mustReload) {
									window.document.body.style.cursor = 'wait';
									grid.trigger("reloadGrid", [{ page: curPage }]);
								}
							}
						}, null,
						function () { throw new error(this.responseText + '\nStatus code :' + this.statusText); },
						function () { window.document.body.style.cursor = 'default'; },
						null);
					//$.post(url, {}, function (data, textStatus, jqXHR) {
					NA.NAEvent.stopPropagation(event);
					//});
				} catch (e) {
					console.log(e);
					window.document.body.style.cursor = 'default';
					if (JSON.parse(e.message)) {
						alert(e.name + ': ' + JSON.parse(e.message));
					}
					else {
						alert(e);
					}
				}
			}
			else {
				document.body.style.cursor = 'default';
				alert('Please select data you want to delete');
			}
			return false;
		});
		NA.NAEvent.addHandler(btnExport, 'click', ExporttoExcel);
		NA.NAEvent.addHandler(btnPrint, 'click', printToPDF);

		//======================END GROUP ASSINGED HANDLER =========================================

		//======================GROUP DIALOG ENTRY==================================================
		window.showDialogEntry = function (event) {//function ini akan di panggil oleh NAJS.common.dialog,setiap menu add/edit/delete,etc di clik 
			//add handler to btnOK untuk mengantisipasi form load gagal
			var dialog = NA.common.dialog.doc.querySelector("div.containerDialog"),
        	   btnOKCancel = NA.NAEvent.doc.querySelectorAll('div.dialogButtonOKCancel>a.button'),
			   btnClose = NA.common.dialog.doc.querySelector('button.ui-button.ui-dialog-titlebar-close');
			//rubah dialog top nya jadi 10px saja
			dialog.style.top = "10px";
			Array.prototype.forEach.call(btnOKCancel, function (item) {//buat jadi foreach mesti convert dulu ke array
				NA.NAEvent.addHandler(item, 'click', function (event) {
					NA.NAEvent.preventDefault(event);
					if (window.status !== 'Open') {
						ExecuteHandler(event.target.innerText);
					}
					//var curPage = grid.getGridParam('page')
					//grid.trigger("reloadGrid", [{ page: 1 }]);
					if (event) {
						NA.NAEvent.stopPropagation(event);
					} document.body.style.cursor = 'default';
					return false;
				});
			});
			NA.NAEvent.addHandler(btnClose, 'click', function (event) {
				NA.NAEvent.preventDefault(event);
				ExecuteHandler('Close');
				if (event) {
					NA.NAEvent.stopPropagation(event);
				}
				document.body.style.cursor = 'default';
				return false;
			});
			try {
				var target = NA.NAEvent.getTarget(event);
				if (target.innerText === ' Add' || target.innerText === ' Edit' || target.innerText === ' Open') {
					if (target.innerText.trim() !== 'Add') {
						var idapp = getGridCellValue(grid,'idapp');
						if (typeof idapp == 'undefined' || IDApp === '') {
							alert('Please select data to edit');
							var dialog = dialog || NA.common.dialog.doc.querySelector("div.containerDialog");
							if (dialog) {
								NA.common.dialog.closeDialog(dialog);
							}
							if (document.body.style.cursor != 'default') { document.body.style.cursor = 'default'; }
							return false;
						}
					}
					$('div.maindialogContent').load("ShowEntry_Receive?" + win.encodeURIComponent('idapp') + '=' + win.encodeURIComponent(idapp) +
                        '&' + win.encodeURIComponent('status') + '=' + win.encodeURIComponent(target.innerText.trim()), function (responseTxt, statusTxt, xhr) {//load /tampilkan form entry data                    

                        	if (statusTxt == "success") { //jika form sudah di load selanjutnya tinggal inisialisasi semua component dan simpang semua ke dalam variable jika perlua

                        		$(this).html(responseTxt);
                        		
                        		//======================BUTTONS Search================================================

                        		var btnFindGoods = NA.common.getElementID('FE_fk_goods'),
									btnFindSuplier = NA.common.getElementID('FE_fk_suplier'),
									btnFindPRBy = NA.common.getElementID('FE_fk_pr_by'),
									btnFindReceivedBy = NA.common.getElementID('FE_fk_receivedby'),
                                    btnAddDetail = NA.common.getElementID('btnAddDetail'),
                                    btnCancelDetail = NA.common.getElementID('btnCancelDetail');
                        		//======================end BUTTONS Search================================================

                        		status = status || win.status || target.innerText.trim();
                        		switch (status) {
                        			case 'Add': {
                        				Array.prototype.forEach.call(NA.common.doc.querySelectorAll('div.dialogButtonEntry>a.button'), function (item) {
                        					if (item.hasAttribute('disabled')) {
                        						item.removeAttribute('disabled');
                        					}//remove attribute disable untuk button OK dan cancel bila statusnya Add
                        				});
                        				break;
                        			}
                        			//case 'Edit': {
                        			//	NA.common.getElementID('id_').disabled = true;
                        			//	break;
                        			//}
                        			case 'Open': {
                        				Array.prototype.forEach.call(NA.common.doc.querySelectorAll('div.dialogButtonEntry>a.button'), function (item) {
                        					if (!item.hasAttribute('disabled')) {
                        						item.setAttribute('disabled', true);
                        					}//remove attribute disable untuk button OK dan cancel bila statusnya Add
                        				});
                        				btnFindGoods.setAttribute('disabled', true);
                        				btnFindSuplier.setAttribute('disabled', true);
                        				btnFindPRBy.setAttribute('disabled', true);
                        				btnFindReceivedBy.setAttribute('disabled', true);
                        				btnAddDetail.setAttribute('disabled', true);
                        				btnCancelDetail.setAttribute('disabled', true);

                                        //bind data to grid detail
                        				break;
                        			}
                        		};

                        	    //grid detail 
                        	    //JQGrid Item Detail
                        		gridTbl = $('jqGrid_NA_F_Goods_Receive_Detail');
                        		gridPager = $('jqGrid_NA_F_Goods_Receive_Detail_Pager');
                        		gridTbl.jqGrid({
                        		    data: (function () {
                        		        if (win.status === 'Open' || win.status === 'Edit') {
                        		            return JSON.parse(initializeForm.dataForGridDetail);
                        		        }
                        		    })(),
                        		    datatype: "local",//column IDapp, NO,	goods 	datereceived supliername FK_ReceivedBy 	receivedby FK_P_R_By pr_by totalpurchase totalreceived 
                        		    colNames: ['idapp', 'NO', 'itemcode', 'goods Description', ],
                        		    colModel: [
                                        { name: 'idapp', hidden: true },
                                        { name: 'fk_appp', hidden: true },
                                        { name: 'no', key: true, width: 40, align: 'right', sortable: false, editable: false, },
                                        {
                                            name: 'brandname', width: 140, align: 'left', sortable: true, editable: true, align: 'center',
                                            editable: true,
                                            cellEdit: true,
                                            edittype: 'select',
                                            formatter: 'select',
                                            editoptions: { value: getAllSelectOptions() }
                                        },
                                        { name: 'goods', index: 'goods', width: 290, sortable: true, editable: false, align: 'left', },
                        		    ],
                        		    cellEdit: false,
                        		    viewrecords: true,
                        		    height: '150px',
                        		    rowNum: (function () {
                        		        if (win.status === 'Open' || win.status === 'Edit') {
                        		            var c = JSON.parse(initializeForm.dataForGridDetail);
                        		            return c.length;
                        		        }
                        		    })(),
                        		    sortname: "brandname",
                        		    sortorder: "asc",
                        		    multiSort: true,
                        		    //shrinkToFit: false,
                        		    iconSet: "fontAwesome",
                        		    //forceFit: true,
                        		    //toolbar: true,
                        		    scrollrows: true,
                        		    //hidegrid: true,
                        		    //caption: "Transactions ---Find goods",
                        		    pager: "#jqGrid_NA_F_Goods_Receive_FK_Goods_Pager"
                        		});
                        	    //gridTbl.navGrid(gridPager,{
                        		//    edit:false,add:false,del:false,search:false
                        	    //}).navButtonAdd('gridPager',{
                        		//    caption:"Save", buttonimg:"fullpath/row-insert-under.gif", onClickButton: function(){
                        		//        var datarow = {name1: value1, name2: value2', ...};
                        		//        var su=jQuery("#grid_id").addRowData("X",datarow,"last");
                        		//        if(su) { jQuery("#grid_id").setSelection('X') }; }, position:"last"
                        		//}).navButtonAdd('#Pager',{
                        		//    caption:"Delete", buttonimg:"fullpath/row-delete.gif", onClickButton: function(){
                        		//        var gr = jQuery("#grid_id").getGridParam("selrow");
                        		//        if( gr != null ) {
                        		//            jQuery("#grid_id").delGridRow(gr,{afterSubmit: function(xhr,postdata){ alert ('After Submit: ' +
                                //            postdata); return [true]},
                        		//                url: 'delete.php'});
                        		//        } else {
                        		//            alert("Please Select Row to delete!");
                        		//        };
                        		//    }, position:"last"
                        		//});

                        		if (status !== 'Open' && status !== '') {//hanya untuk status Add/Edit                                   
                        			//simpan original data di initializeForm
                        			var originalData = JSON.stringify(getValuesForm());
                        			//$('#id_initializeForm').val(originalData);
                        			initializeForm = NA.common.getElementID('id_initializeForm');
                        			initializeForm.Value = originalData;                        		
                        			Array.prototype.forEach.call(NA.common.doc.querySelectorAll('input[type="text"]'), function (item) {
                        			    var valPlaceHolder = item.dataset.value;
                        			    NA.NAEvent.addHandler(item, 'focus', function (event) {
                        			        if (this.value === '') {
                        			            if (this.getAttribute('placeholder') === valPlaceHolder) {
                        			                this.setAttribute('placeholder', '');
                        			            }
                        			        }
                        			    });
                        			    //============blur event================================
                        			    NA.NAEvent.addHandler(item, 'blur', function (event) {
                        			        if (this.value === '') {
                        			            if (this.getAttribute('placeholder') === '') {
                        			                this.setAttribute('placeholder', valPlaceHolder);
                        			            }
                        			        }
                        			    });
                        			    var NAAjax = NA.common.AJAX;
                        			    NA.NAEvent.addHandler(item, 'keydown', function (event) {
                        			        if (event.keyCode === 13) {//kalau menekan tombol enter
                        			            switch (this.id) {
                        			                case 'id_fk_goods': {
                        			                    //prevent default
                        			                    NA.NAEvent.preventDefault(event);//prevent from submit
                        			                    //get data ke database by itemCode
                        			                    //jika ada tampilkan data di form goods_desc
                        			                    NAAjax.GET('getGoods/?' + win.encodeURIComponent('itemcode') + '=' + win.encodeURIComponent(event.target.value),
															'application/json',//overrideMimeType returned by the server
															function (e) { window.document.body.style.cursor = 'wait'; },
															null,//nggak usah di isi bila tidak perlu
															function (e) {//function executed after data has been returned by server(XHR.onload)
															    var data = JSON.parse(this.responseText);
															    if (data) {
															        var txtGoods = NA.common.getElementID('id_goods_desc');
															        txtGoods.value = data['goods'] || '';
															    }
															}, null, function (e) {//function untuk ajax error
															    throw new Error(this.responseText + '\nStatus code :' + this.statusText);
															}, function (e) { window.document.body.style.cursor = 'default'; },//function ajax complete
															null//(parameter tambahan)nggak usah di isi bila tidak perlu(bila mau di isi isi dengan object javascript {key:value}
															);
                        			                    break;
                        			                }
                        			                case 'id_fk_suplier': {

                        			                    //jika ada tampilkan data di form supliername
                        			                    NA.NAEvent.preventDefault(event);//prevent from submit
                        			                    NAAjax.GET('getSuplier/?' + win.encodeURIComponent('supliercode') + '=' + win.encodeURIComponent(event.target.value),
															'application/json',//overrideMimeType returned by the server
															function () { window.document.body.style.cursor = 'wait'; },
															null,//nggak usah di isi bila tidak perlu
															function (e) {//function executed after data has been returned by server(XHR.onload)
															    var data = JSON.parse(this.responseText);
															    if (data) {
															        var txtsuplier = NA.common.getElementID('id_supliername');
															        txtsuplier.value = data['supliername'] || '';
															    }
															}, null, function (e) {//function untuk ajax error
															    throw new Error(this.responseText + '\nStatus code :' + this.statusText);
															}, function (e) { window.document.body.style.cursor = 'default'; },//function ajax complete
															null//(parameter tambahan)nggak usah di isi bila tidak perlu(bila mau di isi isi dengan object javascript {key:value}
															);
                        			                    break;
                        			                }
                        			                case 'id_fk_receivedby': {
                        			                    NA.NAEvent.preventDefault(event);//prevent from submit
                        			                    //jika ada tampilkan data di form employee_Received	NA.NAEvent.preventDefault(event);//prevent from submit
                        			                    NAAjax.GET('getEmployee/?' + win.encodeURIComponent('nik') + '=' + win.encodeURIComponent(event.target.value),
															'application/json',//overrideMimeType returned by the server
															function () { window.document.body.style.cursor = 'wait'; },
															null,//nggak usah di isi bila tidak perlu
															function () {//function executed after data has been returned by server(XHR.onload)
															    var data = JSON.parse(this.responseText);
															    if (data) {
															        var txtreceivedby = NA.common.getElementID('id_employee_received');
															        txtreceivedby.value = data['employee_name'] || '';
															    }
															}, null, function () {//function untuk ajax error
															    throw new Error(this.responseText + '\nStatus code :' + this.statusText);
															}, function () {
															    if (this.status == 404)
															        throw new Error(this.responseText, 'replied 404')
															    window.document.body.style.cursor = 'default';
															},//function ajax complete
															null//(parameter tambahan)nggak usah di isi bila tidak perlu(bila mau di isi isi dengan object javascript {key:value}
															);
                        			                    break;
                        			                }
                        			                case 'id_fk_p_r_by': {
                        			                    NA.NAEvent.preventDefault(event);//prevent from submit
                        			                    //jika ada tampilkan data di form employee_Received	NA.NAEvent.preventDefault(event);//prevent from submit
                        			                    NAAjax.GET('getEmployee/?' + win.encodeURIComponent('nik') + '=' + win.encodeURIComponent(event.target.value),
															'application/json',//overrideMimeType returned by the server
															function () { window.document.body.style.cursor = 'wait'; },
															null,//nggak usah di isi bila tidak perlu
															function () {//function executed after data has been returned by server(XHR.onload)
															    var data = JSON.parse(this.responseText);
															    if (data) {
															        var txtp_r_by = NA.common.getElementID('id_employee_pr');
															        txtp_r_by.value = data['employee_name'] || '';
															    }
															}, null, function () {//function untuk ajax error
															    throw new Error(this.responseText + '\nStatus code :' + this.statusText);
															}, function () { window.document.body.style.cursor = 'default'; },//function ajax complete
															null//(parameter tambahan)nggak usah di isi bila tidak perlu(bila mau di isi isi dengan object javascript {key:value}
															);
                        			                    break;
                        			                }
                        			            }
                        			        }
                        			        return false;
                        			    });
                        			    //====================id_datereceived===========================
                        			    //set JQueryDatePicker
                        			    $('#id_datereceived').datepicker({
                        			        dateFormat: 'dd/mm/yy',
                        			        changeMonth: true,
                        			        changeYear: true,
                        			        minDate: (function (g) {
                        			            if (g.status === 'Edit') {
                        			                var elDateReceived = JSON.Parse(originalData),
                                                    valDateReceived = new Date(ElDateReceived.datereceived);
                        			                return valDateReceived.getDate();
                        			            }
                        			            else { return null; }
                        			            //get date datereceived
                        			        })(window),
                        			        maxDate: 'today',
                        			    });
                        			    //setting Custom Validity
                        			    var elm = NA.common.doc.querySelector('#id_datereceived');
                        			    NA.NAEvent.addHandler(elm, 'input', function (event) {
                        			        var elpat = this.getAttribute('patern');
                        			        var patern = new RegExp(elpat, 'i');
                        			        var valuePat = this.value;
                        			        if (valuePat === null || valuePat === '') {
                        			            valuePat = this.textcontent;
                        			        }
                        			        if (!patern.test(valuePat)) {
                        			            this.setCustomValidity('Invalid date value');
                        			            this.validity.valid = false;
                        			        }
                        			        else {
                        			            this.setCustomValidity(''); //clearkan error custom validity
                        			        }
                        			    });
                        			    //=====================end id_datereceived==========================================

                        			    Array.prototype.forEach.call(NA.common.doc.querySelectorAll('input[type="number"]'), function (item) {
                        			        //protect total receive tidak boleh lebih besar dari total purchase
                        			        //value total purchase tidak boleh kurang dari 0
                        			        //value total purchase dan total receive tidak boleh negatif
                        			        //jika yang di isi total purchase maka otomatis total receive nya sama 
                        			        var elTotalReceived = NA.common.getElementID('id_totalreceived'),
                                                elTotalPurchase = NA.common.getElementID('id_totalpurchase');
                        			        NA.NAEvent.addHandler(item, 'paste', function (e) {
                        			            if (!/^\d*$/.test(text)) {
                        			                NA.NAEvent.preventDefault(e);
                        			            }
                        			        });
                        			        NA.NAEvent.addHandler(item, 'keydown', function (e) {
                        			            if (!NA.common.numberInput(e)) {
                        			                e.returnValue = false;
                        			                NA.NAEvent.preventDefault(e);
                        			            }
                        			        });
                        			        NA.NAEvent.addHandler(item, 'input', function (event) {
                        			            if (item.id === 'id_totalpurchase') {
                        			                if (parseInt(item.value) <= 0) {
                        			                    this.setCustomValidity('total purchase is not allowed to be null or zero or negative');
                        			                    this.validity.valid = false;
                        			                }
                        			                else {
                        			                    elTotalReceived.value = item.value;
                        			                    this.setCustomValidity('');
                        			                }
                        			            }
                        			            else if (item.id == elTotalReceived.id) {
                        			                if (parseInt(item.value) > elTotalPurchase.value) {
                        			                    this.setCustomValidity('total receive is over than total purchase');
                        			                    this.validity.valid = false;
                        			                }
                        			                else {
                        			                    this.setCustomValidity('');
                        			                }
                        			            }
                        			        });
                        			    });

                        			    //======================event handler BUTTONS Search================================================                        		
                        			    var txtSearch = null, containerMessage = null; var gridTbl = null, gridPager = null;
                        			    NA.NAEvent.addHandler(btnFindGoods, 'click', function (event) {
                        			        //create bootstrapDialog                        				
                        			        BootstrapDialog.show({

                        			            //message: (function () {
                        			            //	//==============create formSearching===============
                        			            //	//create div for container
                        			            //	//create header div for searching
                        			            //	//create div for main container                        					
                        			            draggable: true,
                        			            type: BootstrapDialog.TYPE_SUCCESS,
                        			            size: BootstrapDialog.SIZE_SMALL,
                        			            message: function (dialogRef) {

                        			                var placeHolder = 'Enter goods desc to search for';
                        			                containerMessage = NA.common.dialog.createFormContainer('fk_goods', placeHolder,
                                                    function (e) {//event for blur
                                                        if (this.value === '') {
                                                            if (this.getAttribute('placeholder') === '') {
                                                                this.setAttribute('placeholder', placeHolder);
                                                            }
                                                        }
                                                    },
                                                    function (e) {//event for focus
                                                        if (this.value === '') {
                                                            if (this.getAttribute('placeholder') === placeHolder) {
                                                                this.setAttribute('placeholder', '');
                                                            }
                                                        }
                                                    },
                                                    function (e) {//even for keydown txtSearch													
                                                        if (e.keyCode === 13) {
                                                            NA.NAEvent.preventDefault(e);
                                                            win.document.body.style.cursor = 'wait';
                                                            //cari data ke database
                                                            var url = 'SearchGoodsbyForm/?' + win.encodeURIComponent('goods_desc') + '=' + win.encodeURIComponent(e.target.value.trim());
                                                            if (gridTbl) {
                                                                jQuery(gridTbl).setGridParam({ url: url }).trigger("reloadGrid", [{ page: 1, }]);
                                                            }
                                                            win.document.body.style.cursor = 'default';
                                                            NA.NAEvent.stopPropagation(e);
                                                        }
                                                    }, function (e) {
                                                        txtSearch = NA.common.getElementID('txtsearch_fk_goods');
                                                        NA.common.triggerKeyboardEvent(txtSearch, 13);
                                                    });
                        			                var children = containerMessage.childNodes;
                        			                var mainContainer = null, txtSearch = null;
                        			                for (var i = 0, len = children.length; i < len; i++) {
                        			                    if (children[i].nodeType == 1 && children[i].className === 'maincontainerForm fk_goods') {
                        			                        mainContainer = children[i]; break;
                        			                    }
                        			                };

                        			                //loads Data into JqueryGrid
                        			                gridTbl = NA.common.doc.createElement('table');
                        			                gridTbl.id = 'jqGrid_NA_F_Goods_Receive_FK_Goods';
                        			                gridPager = NA.common.doc.createElement('div');
                        			                gridPager.id = 'jqGrid_NA_F_Goods_Receive_FK_Goods_Pager';
                        			                mainContainer.appendChild(gridTbl);
                        			                mainContainer.appendChild(gridPager);
                        			                return containerMessage;
                        			            },
                        			            onshown: function (dialogRef) {
                        			                txtSearch = NA.common.getElementID('txtsearch_fk_goods');
                        			                var valSearch = '';
                        			                if (txtSearch != null) {
                        			                    valSearch = win.encodeURIComponent(txtSearch.textContent.trim());
                        			                }
                        			                gridTbl = $('#jqGrid_NA_F_Goods_Receive_FK_Goods');
                        			                var urlFKGoods = 'SearchGoodsbyForm/?' + win.encodeURIComponent('goods_desc') + '=' + valSearch;
                        			                gridTbl.jqGrid({
                        			                    url: urlFKGoods,
                        			                    mtype: "GET",
                        			                    datatype: "json",//column IDapp, NO,	goods 	datereceived supliername FK_ReceivedBy 	receivedby FK_P_R_By pr_by totalpurchase totalreceived 
                        			                    colNames: ['idapp', 'NO', 'itemcode', 'goods Description', ],
                        			                    colModel: [
                                                            { name: 'idapp', key: true, hidden: true, align: 'left' },
                                                            { name: 'no', width: 40, align: 'right', sortable: false, editable: false, },
                                                            { name: 'itemcode', width: 80, align: 'left', sortable: true, editable: false, },
                                                            { name: 'goods', index: 'goods', width: 290, sortable: true, editable: false, align: 'left', },
                        			                    ],
                        			                    ondblClickRow: function (rowId) {
                        			                        //fire button OK
                        			                        var btnOK = dialogRef.getButton('btnOKFindGoods');
                        			                        btnOK.click();
                        			                    },
                        			                    gridComplete: function () {
                        			                        document.body.style.cursor = 'default';
                        			                    },
                        			                    loadError: function (xhr, textStatus, errorThrown) {
                        			                        var error_msg = xhr.responseText
                        			                        var msg = "Some errors occurred during processing:"
                        			                        msg += '\n\n' + error_msg
                        			                        alert(msg)
                        			                    },
                        			                    cellEdit: false,
                        			                    viewrecords: true,
                        			                    height: '150px',
                        			                    rowNum: 500,
                        			                    rowList: [20, 50, 100, 200, 300, 500],
                        			                    sortname: "itemcode",
                        			                    sortorder: "asc",
                        			                    multiSort: true,
                        			                    //shrinkToFit: false,
                        			                    iconSet: "fontAwesome",
                        			                    //forceFit: true,
                        			                    //toolbar: true,
                        			                    scrollrows: true,
                        			                    //hidegrid: true,
                        			                    //caption: "Transactions ---Find goods",
                        			                    pager: "#jqGrid_NA_F_Goods_Receive_FK_Goods_Pager"
                        			                });
                        			                gridTbl.navGrid('#jqGrid_NA_F_Goods_Receive_FK_Goods_Pager', {
                        			                    search: false, // show search button on the toolbar
                        			                    add: false,
                        			                    edit: false,
                        			                    del: false,
                        			                    refresh: false
                        			                });
                        			                restyleBoostrapDialog();
                        			                var gbox = NA.common.doc.querySelector('div#gbox_jqGrid_NA_F_Goods_Receive_FK_Goods');
                        			                gbox.style.width = '432px';
                        			                var gview = NA.common.doc.querySelector('div#gview_jqGrid_NA_F_Goods_Receive_FK_Goods');
                        			                gview.style.width = '432px';

                        			                var tdInfo = NA.common.doc.getElementById('jqGrid_NA_F_Goods_Receive_FK_Goods_Pager_right');
                        			                tdInfo.style.width = '110px';
                        			                var pager = NA.common.getElementID('jqGrid_NA_F_Goods_Receive_FK_Goods_Pager');
                        			                pager.style.width = '430px';

                        			            },
                        			            closable: false,
                        			            animate: false,
                        			            closeByBackdrop: false,
                        			            closeByKeyboard: false,
                        			            buttons: [{
                        			                label: 'Cancel',
                        			                icon: 'glyphicon glyphicon-remove',
                        			                cssClass: 'btn-success',
                        			                action: function (dialogRef) {
                        			                    dialogRef.close();
                        			                },
                        			            }, {
                        			                label: 'OK',
                        			                id: 'btnOKFindGoods',
                        			                icon: 'glyphicon glyphicon-ok',
                        			                cssClass: 'btn-success',
                        			                action: function (dialogRef) {
                        			                    var idapp = getGridCellValue(gridTbl, 'idapp');
                        			                    if (idapp) {//cell di select sama user
                        			                        //tempelkan data row di fk_goods, dan valuenya di goods_desc;
                        			                        var rowId = gridTbl.jqGrid('getGridParam', 'selrow');
                        			                        var rowData = gridTbl.getRowData(rowId);
                        			                        var itemCode = rowData['itemcode'], goods_Desc = rowData['goods'];
                        			                        var txtid_fk_goods = NA.common.getElementID('id_fk_goods');
                        			                        txtid_fk_goods.value = itemCode;
                        			                        txtid_fk_goods.attributes['placeholder'] = '';
                        			                        var txtgoodsDesc = NA.common.getElementID('id_goods_desc');
                        			                        txtgoodsDesc.value = goods_Desc;
                        			                        txtgoodsDesc.attributes['placeholder'] = '';
                        			                        //simpan IDAppFKGoods di elementHidden
                        			                        var elemIDApp = NA.common.getElementID('id_idapp_fk_goods');
                        			                        elemIDApp.value = idapp;
                        			                        dialogRef.close();
                        			                    }
                        			                }
                        			            }]
                        			        });
                        			    });
                        			    NA.NAEvent.addHandler(btnFindSuplier, 'click', function (event) {
                        			        //create bootstrapDialog
                        			        BootstrapDialog.show({
                        			            draggable: true,
                        			            type: BootstrapDialog.TYPE_SUCCESS,
                        			            size: BootstrapDialog.SIZE_SMALL,
                        			            message: function (dialogRef) {
                        			                var placeHolder = 'Enter Suplier name to search for';
                        			                var containerMessage = NA.common.dialog.createFormContainer('fk_suplier', placeHolder,
                                                    function (e) {//event for blur
                                                        if (this.value === '') {
                                                            if (this.getAttribute('placeholder') === '') {
                                                                this.setAttribute('placeholder', placeHolder);
                                                            }
                                                        }
                                                    },
                                                    function (e) {//event for focus
                                                        if (this.value === '') {
                                                            if (this.getAttribute('placeholder') === placeHolder) {
                                                                this.setAttribute('placeholder', '');
                                                            }
                                                        }
                                                    },
                                                    function (e) {//even for keydown txtSearch
                                                        if (e.keyCode === 13) {
                                                            win.document.body.style.cursor = 'wait';
                                                            //cari data ke database
                                                            var url = 'SearchSuplierbyForm/?' + win.encodeURIComponent('supliername') + '=' + win.encodeURIComponent(e.target.value.trim());

                                                            if (gridTbl) {
                                                                gridTbl.setGridParam({ url: url }).trigger("reloadGrid", [{ page: 1, }]);
                                                            }
                                                            win.document.body.style.cursor = 'default';
                                                        }
                                                    });
                        			                var children = containerMessage.childNodes;
                        			                var mainContainer = null, txtSearch = null;
                        			                for (var i = 0, len = children.length; i < len; i++) {
                        			                    if (children[i].nodeType == 1 && children[i].className === 'maincontainerForm fk_suplier') {
                        			                        mainContainer = children[i]; break;
                        			                    }
                        			                };
                        			                //loads Data into JqueryGrid
                        			                gridTbl = NA.common.doc.createElement('table');
                        			                gridTbl.id = 'jqGrid_NA_F_Goods_Receive_fk_suplier';
                        			                gridPager = NA.common.doc.createElement('div');
                        			                gridPager.id = 'jqGrid_NA_F_Goods_Receive_fk_suplier_Pager';
                        			                mainContainer.appendChild(gridTbl);
                        			                mainContainer.appendChild(gridPager);
                        			                return containerMessage;
                        			            },
                        			            onshown: function (dialogRef) {
                        			                txtSearch = NA.common.getElementID('txtsearch_fk_suplier');
                        			                //loads Data into JqueryGrid 
                        			                gridTbl = $('#jqGrid_NA_F_Goods_Receive_fk_suplier');
                        			                gridPager = $('#jqGrid_NA_F_Goods_Receive_fk_suplier_Pager');
                        			                var urlFKSuplier = 'SearchSuplierbyForm/?' + win.encodeURIComponent('supliername') + '=' + win.encodeURIComponent(txtSearch.textContent.trim());
                        			                gridTbl.jqGrid({
                        			                    url: urlFKSuplier,
                        			                    mtype: "GET",
                        			                    datatype: "json",//column idapp, no,supliercode,supliername
                        			                    colNames: ['NO', 'suplier code', 'suplier name', ],
                        			                    colModel: [
                                                            { name: 'no', width: 40, align: 'right', sortable: false, editable: false, },
                                                            { name: 'supliercode', width: 90, align: 'left', sortable: true, editable: false, },
                                                            { name: 'supliername', index: 'supliername', width: 290, sortable: true, editable: false, align: 'left', },
                        			                    ],
                        			                    ondblClickRow: function (rowId) {
                        			                        //fire button OK
                        			                        var btnOK = dialogRef.getButton('btnOKFindsuplier');
                        			                        btnOK.click();
                        			                    },
                        			                    gridComplete: function () {
                        			                        document.body.style.cursor = 'default';
                        			                    },
                        			                    loadError: function (xhr, textStatus, errorThrown) {
                        			                        var error_msg = xhr.responseText
                        			                        var msg = "Some errors occurred during processing:"
                        			                        msg += '\n\n' + error_msg
                        			                        alert(msg)
                        			                    },
                        			                    cellEdit: false,
                        			                    viewrecords: true,
                        			                    height: '150px',
                        			                    rowNum: 500,
                        			                    rowList: [20, 50, 100, 200, 300, 500],
                        			                    sortname: "supliername",
                        			                    sortorder: "asc",
                        			                    multiSort: true,
                        			                    //shrinkToFit: false,
                        			                    iconSet: "fontAwesome",
                        			                    //forceFit: true,
                        			                    //toolbar: true,
                        			                    scrollrows: true,
                        			                    //hidegrid: true,
                        			                    pager: "#jqGrid_NA_F_Goods_Receive_fk_suplier_Pager"
                        			                });
                        			                gridTbl.navGrid(gridPager, {
                        			                    search: false, // show search button on the toolbar
                        			                    add: false,
                        			                    edit: false,
                        			                    del: false,
                        			                    refresh: false
                        			                });
                        			            },
                        			            closable: false,
                        			            animate: false,
                        			            closeByBackdrop: false,
                        			            closeByKeyboard: false,
                        			            buttons: [{
                        			                label: 'Cancel',
                        			                icon: 'glyphicon glyphicon-remove',
                        			                cssClass: 'btn-success',
                        			                action: function (dialogRef) {
                        			                    dialogRef.close();
                        			                },
                        			            }, {
                        			                label: 'OK',
                        			                id: 'btnOKFindsuplier',
                        			                icon: 'glyphicon glyphicon-ok',
                        			                cssClass: 'btn-success',
                        			                action: function (dialogRef) {
                        			                    var supliercode = getGridCellValue(gridTbl, 'supliercode');
                        			                    if (supliercode) {//cell di select sama user
                        			                        //tempelkan data row di fk_goods, dan valuenya di goods_desc;
                        			                        var rowId = gridTbl.jqGrid('getGridParam', 'selrow');
                        			                        var rowData = gridTbl.getRowData(rowId);
                        			                        var supliername = rowData['supliername'];
                        			                        var txtid_fk_suplier = NA.common.getElementID('id_fk_suplier');
                        			                        txtid_fk_suplier.value = supliercode;
                        			                        txtid_fk_suplier.attributes['placeholder'] = '';
                        			                        var txtsupliername = NA.common.getElementID('id_supliername');
                        			                        txtsupliername.value = supliername;
                        			                        txtsupliername.attributes['placeholder'] = '';
                        			                    }
                        			                    dialogRef.close();
                        			                }
                        			            }]
                        			        });
                        			        //Atur tampilan                        			
                        			        restyleBoostrapDialog();
                        			        var gbox = NA.common.doc.querySelector('div#gbox_jqGrid_NA_F_Goods_Receive_fk_suplier');
                        			        gbox.style.width = '432px';
                        			        var gview = NA.common.doc.querySelector('div#gview_jqGrid_NA_F_Goods_Receive_fk_suplier');
                        			        gview.style.width = '432px';
                        			        var tdInfo = NA.common.doc.getElementById('jqGrid_NA_F_Goods_Receive_fk_suplier_Pager_right');
                        			        tdInfo.style.width = '110px';
                        			        var pager = NA.common.getElementID('jqGrid_NA_F_Goods_Receive_fk_suplier_Pager');
                        			        pager.style.width = '430px';

                        			    });
                        			    NA.NAEvent.addHandler(btnFindPRBy, 'click', function (event) {
                        			        //create bootstrapDialog
                        			        BootstrapDialog.show({
                        			            draggable: true,
                        			            type: BootstrapDialog.TYPE_SUCCESS,
                        			            size: BootstrapDialog.SIZE_SMALL,
                        			            message: function (dialogRef) {
                        			                var placeHolder = 'Enter Employee who PRs to search for';
                        			                //var gridTbl = null, gridPager = null;
                        			                var containerMessage = NA.common.dialog.createFormContainer('fk_p_r_by', placeHolder,
                                                    function (e) {//event for blur
                                                        if (this.value === '') {
                                                            if (this.getAttribute('placeholder') === '') {
                                                                this.setAttribute('placeholder', placeHolder);
                                                            }
                                                        }
                                                    },
                                                    function (e) {//event for focus
                                                        if (this.value === '') {
                                                            if (this.getAttribute('placeholder') === placeHolder) {
                                                                this.setAttribute('placeholder', '');
                                                            }
                                                        }
                                                    },
                                                    function (e) {//even for keydown txtSearch
                                                        if (e.keyCode === 13) {
                                                            win.document.body.style.cursor = 'wait';
                                                            //cari data ke database
                                                            var url = 'Searchbyform/?' + win.encodeURIComponent('employee_name') + '=' + win.encodeURIComponent(e.target.value.trim());

                                                            if (gridTbl) {
                                                                gridTbl.setGridParam({ url: url }).trigger("reloadGrid", [{ page: 1, }]);
                                                            }
                                                            win.document.body.style.cursor = 'default';
                                                        }
                                                    });
                        			                var children = containerMessage.childNodes;
                        			                var mainContainer = null, txtSearch = null;
                        			                for (var i = 0, len = children.length; i < len; i++) {
                        			                    if (children[i].nodeType == 1 && children[i].className === 'maincontainerForm fk_p_r_by') {
                        			                        mainContainer = children[i]; break;
                        			                    }
                        			                };
                        			                //loads Data into JqueryGrid
                        			                gridTbl = NA.common.doc.createElement('table');
                        			                gridTbl.id = 'jqGrid_NA_F_Goods_Receive_fk_p_r_by';
                        			                gridPager = NA.common.doc.createElement('div');
                        			                gridPager.id = 'jqGrid_NA_F_Goods_Receive_fk_p_r_by_Pager';
                        			                mainContainer.appendChild(gridTbl);
                        			                mainContainer.appendChild(gridPager);
                        			                return containerMessage;
                        			            },
                        			            onshown: function (dialogRef) {
                        			                var txtSearch = NA.common.getElementID('txtsearch_fk_p_r_by');
                        			                //loads Data into JqueryGrid
                        			                gridTbl = $('#jqGrid_NA_F_Goods_Receive_fk_p_r_by');
                        			                gridPager = $('jqGrid_NA_F_Goods_Receive_fk_p_r_by_Pager');
                        			                var urlPR = 'SearchEmployeebyform/?' + win.encodeURIComponent('employee_name') + '=' + win.encodeURIComponent(txtSearch.textContent.trim());
                        			                gridTbl.jqGrid({
                        			                    url: urlPR,
                        			                    mtype: "GET",
                        			                    datatype: "json",//column IDapp, NO,	goods 	datereceived supliername FK_ReceivedBy 	receivedby FK_P_R_By pr_by totalpurchase totalreceived 
                        			                    colNames: ['idapp', 'NO', 'NIK', 'Employee Name', ],
                        			                    colModel: [
                                                            { name: 'idapp', key: true, hidden: true, align: 'left' },
                                                            { name: 'no', width: 40, align: 'right', sortable: false, editable: false, },
                                                            { name: 'nik', width: 90, align: 'left', sortable: true, editable: false, },
                                                            { name: 'employee_name', index: 'employee_name', width: 290, sortable: true, editable: false, align: 'left', },
                        			                    ],
                        			                    ondblClickRow: function (rowId) {
                        			                        //fire button OK
                        			                        var btnOK = dialogRef.getButton('btnOKFind_p_r_by');
                        			                        btnOK.click();
                        			                    },
                        			                    gridComplete: function () {
                        			                        document.body.style.cursor = 'default';
                        			                    },
                        			                    cellEdit: false,
                        			                    viewrecords: true,
                        			                    height: '150px',
                        			                    rowNum: 500,
                        			                    rowList: [20, 50, 100, 200, 300, 500],
                        			                    sortname: "employee_name",
                        			                    sortorder: "asc",
                        			                    multiSort: true,
                        			                    //shrinkToFit: false,
                        			                    iconSet: "fontAwesome",
                        			                    //forceFit: true,
                        			                    //toolbar: true,
                        			                    scrollrows: true,
                        			                    pager: "#jqGrid_NA_F_Goods_Receive_fk_p_r_by_Pager"
                        			                });
                        			                gridTbl.navGrid(gridPager, {
                        			                    search: false, // show search button on the toolbar
                        			                    add: false,
                        			                    edit: false,
                        			                    del: false,
                        			                    refresh: false
                        			                });
                        			            },
                        			            animate: false,
                        			            closable: false,
                        			            closeByBackdrop: false,
                        			            closeByKeyboard: false,
                        			            buttons: [{
                        			                label: 'Cancel',
                        			                icon: 'glyphicon glyphicon-remove',
                        			                cssClass: 'btn-success',
                        			                action: function (dialogRef) {
                        			                    dialogRef.close();
                        			                },
                        			            }, {
                        			                label: 'OK',
                        			                id: 'btnOKFind_p_r_by',
                        			                icon: 'glyphicon glyphicon-ok',
                        			                cssClass: 'btn-success',
                        			                action: function (dialogRef) {
                        			                    var fk_p_r_by = getGridCellValue(gridTbl, 'nik');
                        			                    if (fk_p_r_by) {//cell di select sama user
                        			                        //tempelkan data row di fk_goods, dan valuenya di goods_desc;
                        			                        var rowId = gridTbl.jqGrid('getGridParam', 'selrow');
                        			                        var rowData = gridTbl.getRowData(rowId);
                        			                        var employeeName = rowData['employee_name'];
                        			                        var idapp = rowData['idapp'];
                        			                        var txt_fk_p_r_by = NA.common.getElementID('id_fk_p_r_by');
                        			                        txt_fk_p_r_by.value = fk_p_r_by;
                        			                        txt_fk_p_r_by.attributes['placeholder'] = '';

                        			                        var txtp_r_by = NA.common.getElementID('id_employee_pr');
                        			                        txtp_r_by.value = employeeName;
                        			                        txtp_r_by.attributes['placeholder'] = '';
                        			                        //simpan IDAppFKGoods di elementHidden
                        			                        var elemIDApp = NA.common.getElementID('id_idapp_fk_p_r_by');
                        			                        elemIDApp.value = idapp;
                        			                        dialogRef.close();
                        			                    }
                        			                }
                        			            }]
                        			        });
                        			        //Atur tampilan                        			
                        			        restyleBoostrapDialog();
                        			        var gbox = NA.common.doc.querySelector('div#gbox_jqGrid_NA_F_Goods_Receive_fk_p_r_by');
                        			        gbox.style.width = '432px';
                        			        var gview = NA.common.doc.querySelector('div#gview_jqGrid_NA_F_Goods_Receive_fk_p_r_by');
                        			        gview.style.width = '432px';
                        			        var tdInfo = NA.common.doc.getElementById('jqGrid_NA_F_Goods_Receive_fk_p_r_by_Pager_right');
                        			        tdInfo.style.width = '110px';
                        			        var pager = NA.common.getElementID('jqGrid_NA_F_Goods_Receive_fk_p_r_by_Pager');
                        			        pager.style.width = '430px';
                        			    });
                        			    NA.NAEvent.addHandler(btnFindReceivedBy, 'click', function (event) {
                        			        //create bootstrapDialog
                        			        BootstrapDialog.show({
                        			            draggable: true,
                        			            type: BootstrapDialog.TYPE_SUCCESS,
                        			            size: BootstrapDialog.SIZE_SMALL,
                        			            message: function (dialogRef) {
                        			                var placeHolder = 'Enter Employee who Received goods to search for';
                        			                var containerMessage = NA.common.dialog.createFormContainer('fk_receivedby', placeHolder,
                                                    function (e) {//event for blur
                                                        if (this.value === '') {
                                                            if (this.getAttribute('placeholder') === '') {
                                                                this.setAttribute('placeholder', placeHolder);
                                                            }
                                                        }
                                                    },
                                                    function (e) {//event for focus
                                                        if (this.value === '') {
                                                            if (this.getAttribute('placeholder') === placeHolder) {
                                                                this.setAttribute('placeholder', '');
                                                            }
                                                        }
                                                    },
                                                    function (e) {//even for keydown txtSearch
                                                        if (e.keyCode === 13) {
                                                            win.document.body.style.cursor = 'wait';
                                                            //cari data ke database
                                                            var url = 'SearchEmployeebyform/?' + win.encodeURIComponent('employee_name') + '=' + win.encodeURIComponent(e.target.value.trim());
                                                            if (gridTbl) {
                                                                gridTbl.setGridParam({ url: url }).trigger("reloadGrid", [{ page: 1, }]);
                                                            }
                                                            win.document.body.style.cursor = 'default';
                                                        }
                                                    });
                        			                var children = containerMessage.childNodes;
                        			                var mainContainer = null, txtSearch = null;
                        			                for (var i = 0, len = children.length; i < len; i++) {
                        			                    if (children[i].nodeType == 1 && children[i].className === 'maincontainerForm fk_receivedby') {
                        			                        mainContainer = children[i]; break;
                        			                    }
                        			                };

                        			                gridTbl = NA.common.doc.createElement('table');
                        			                gridTbl.id = 'jqGrid_NA_F_Goods_Receive_fk_receivedby';
                        			                gridPager = NA.common.doc.createElement('div');
                        			                gridPager.id = 'jqGrid_NA_F_Goods_Receive_fk_receivedby_Pager';
                        			                mainContainer.appendChild(gridTbl);
                        			                mainContainer.appendChild(gridPager)
                        			                return containerMessage;
                        			            },
                        			            onshown: function (dialogRef) {
                        			                var txtSearch = NA.common.getElementID('txtsearch_fk_receivedby');
                        			                //loads Data into JqueryGrid
                        			                gridTbl = $('#jqGrid_NA_F_Goods_Receive_fk_receivedby');
                        			                gridPager = $('#jqGrid_NA_F_Goods_Receive_fk_receivedby_Pager');
                        			                var urlPR = 'SearchEmployeebyform/?' + win.encodeURIComponent('employee_name') + '=' + win.encodeURIComponent(txtSearch.textContent.trim());
                        			                gridTbl.jqGrid({
                        			                    url: urlPR,
                        			                    mtype: "GET",
                        			                    datatype: "json",//column IDapp, NO,	goods 	datereceived supliername FK_ReceivedBy 	receivedby FK_P_R_By pr_by totalpurchase totalreceived 
                        			                    colNames: ['idapp', 'NO', 'NIK', 'Employee Name', ],
                        			                    colModel: [
                                                            { name: 'idapp', key: true, hidden: true, align: 'left' },
                                                            { name: 'no', width: 40, align: 'right', sortable: false, editable: false, },
                                                            { name: 'nik', width: 90, align: 'left', sortable: true, editable: false, },
                                                            { name: 'employee_name', index: 'employee_name', width: 290, sortable: true, editable: false, align: 'left', },
                        			                    ],
                        			                    ondblClickRow: function (rowId) {
                        			                        //fire button OK
                        			                        var btnOK = dialogRef.getButton('btnOKFind_receivedby');
                        			                        btnOK.click();
                        			                    },
                        			                    gridComplete: function () {
                        			                        document.body.style.cursor = 'default';
                        			                    },
                        			                    cellEdit: false,
                        			                    viewrecords: true,
                        			                    height: '150px',
                        			                    rowNum: 500,
                        			                    rowList: [20, 50, 100, 200, 300, 500],
                        			                    sortname: "employee_name",
                        			                    sortorder: "asc",
                        			                    multiSort: true,
                        			                    //shrinkToFit: false,
                        			                    iconSet: "fontAwesome",
                        			                    //forceFit: true,
                        			                    //toolbar: true,
                        			                    scrollrows: true,
                        			                    pager: "#jqGrid_NA_F_Goods_Receive_fk_receivedby_Pager"
                        			                });
                        			                gridTbl.navGrid(gridPager, {
                        			                    search: false, // show search button on the toolbar
                        			                    add: false,
                        			                    edit: false,
                        			                    del: false,
                        			                    refresh: false
                        			                });
                        			            },
                        			            animate: false,
                        			            closable: false,
                        			            closeByBackdrop: false,
                        			            closeByKeyboard: false,
                        			            buttons: [{
                        			                label: 'Cancel',
                        			                icon: 'glyphicon glyphicon-remove',
                        			                cssClass: 'btn-success',
                        			                action: function (dialogRef) {
                        			                    dialogRef.close();
                        			                },
                        			            }, {
                        			                label: 'OK',
                        			                id: 'btnOKFind_receivedby',
                        			                icon: 'glyphicon glyphicon-ok',
                        			                cssClass: 'btn-success',
                        			                action: function (dialogRef) {
                        			                    var fk_receivedby = getGridCellValue(gridTbl, 'nik');
                        			                    if (fk_receivedby) {//cell di select sama user
                        			                        //tempelkan data row di fk_goods, dan valuenya di goods_desc;
                        			                        var rowId = gridTbl.jqGrid('getGridParam', 'selrow');
                        			                        var rowData = gridTbl.getRowData(rowId);
                        			                        var employeeName = rowData['employee_name'];
                        			                        var idapp = rowData['idapp'];
                        			                        var txt_fk_receivedby = NA.common.getElementID('id_fk_receivedby');
                        			                        txt_fk_receivedby.value = fk_receivedby;
                        			                        txt_fk_receivedby.attributes['placeholder'] = '';

                        			                        var txt_employee_received = NA.common.getElementID('id_employee_received');
                        			                        txt_employee_received.value = employeeName;
                        			                        txt_employee_received.attributes['placeholder'] = '';

                        			                        //simpan IDAppFKGoods di elementHidden
                        			                        var elemIDApp = NA.common.getElementID('id_idapp_fk_receivedby');
                        			                        elemIDApp.value = idapp;
                        			                        dialogRef.close();
                        			                    }
                        			                }
                        			            }]
                        			        });
                        			        //Atur tampilan                        			
                        			        restyleBoostrapDialog();
                        			        var gbox = NA.common.doc.querySelector('div#gbox_jqGrid_NA_F_Goods_Receive_fk_receivedby');
                        			        gbox.style.width = '432px';
                        			        var gview = NA.common.doc.querySelector('div#gview_jqGrid_NA_F_Goods_Receive_fk_receivedby');
                        			        gview.style.width = '432px';
                        			        var tdInfo = NA.common.doc.getElementById('jqGrid_NA_F_Goods_Receive_fk_receivedby_Pager_right');
                        			        tdInfo.style.width = '110px';
                        			        var pager = NA.common.getElementID('jqGrid_NA_F_Goods_Receive_fk_receivedby_Pager');
                        			        pager.style.width = '430px';
                        			    });

                        			    NA.NAEvent.addHandler(btnAddDetail, 'click', function (e) {
                        			        //check totalReveive
                        			        var elTotalReceived = NA.common.getElementID('id_totalreceived');
                        			        if (elTotalReceived.value == '') {
                        			            BootstrapDialog.alert('Please define');
                        			        }
                        			    });

                        			    NA.NAEvent.addHandler(btnCancelDetail, 'click', function (e) {

                        			        //
                        			        NA.NAEvent.removeHandler(gridTbl, 'keyup', deletegridDetail);
                        			    });
                        			    //assign delete key event
                        			    gridTbl.on("keyup", "tr", deletegridDetail);

                        			});
                        		}//hanya untuk status Add/Edit                  	    
                        	}
                        	NA.NAEvent.preventDefault(event);
                        	if (document.body.style.cursor != 'default') { document.body.style.cursor = 'default'; }
                        });
				}
				//else if(target.innerText === ' Employee'){
				//    alert('employee load');
				//    return false;
				//}                
			} catch (e) {
				dialog = NA.common.dialog.doc.querySelector("div.containerDialog");
				if (dialog) {
					NA.common.dialog.closeDialog(dialog);
				}
				if (document.body.style.cursor != 'default') { document.body.style.cursor = 'default'; }
				alert(e);
			}
		};
	})();
</script>
{% endblock %}