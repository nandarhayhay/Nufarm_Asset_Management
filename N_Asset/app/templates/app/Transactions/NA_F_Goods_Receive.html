{% extends "../../app/layout.html" %}
{% block SearchData %}
{% for itemCombo in populateColumn %}
<li><a href="#" data-tipe="{{itemCombo.dataType}}" data-column="{{itemCombo.columnName}}">{{itemCombo.label}}</a></li>
{% endfor %}

t>

{% endblock %}

{% block javascriptAndUI %}
<!--================================Load Script Modules NA ===========================================-->
<script type="text/javascript" src="../../../static/app/scripts/NAJS.js"></script>
<!--=======================================================================================================-->

<script type="text/javascript">
    
	(function(){ 

	    if (!NA.common.getElementID('CustomSearch')) {
	        var parentC = NA.common.doc.querySelector('ul.dropdown-menu.search');
	        lastLi = NA.common.doc.createElement('li'),
			lastLi_a = NA.common.doc.createElement('a');
	        lastLi_a.setAttribute('id', 'custSearch');
	        lastLi_a.textContent = 'CustomSearch';
	        lastLi.appendChild(lastLi_a);
	        parentC.appendChild(lastLi);
	    }
//=================add Dynamic Styles=============================
        NA.common.loadStyles("../../../static/app/content/jquery-ui.min.css","jqueryUI");
        NA.common.loadStyles("../../../static/app/content/ui.jqgrid.css","UIJqueryGrid");   
        var doc = doc||window.document;
        var DivSearch = doc.querySelector('ul.dropdown-menu.search');//return list Element
        (function(elm){
            var listElem = elm.children;
            Array.prototype.forEach.call(listElem,function(item){//buat jadi foreach mesti convert dulu ke array
                NA.NAEvent.addHandler(item, 'click', function (event) {
                    event.preventDefault();
                    if (item.firstChild.id === 'custSearch') {
                        //=========='show dialog search'==================
                        //NA.common.dialog.createSearchDialog(event)
                    }
                    NA.common.getElementID('bySearch').firstChild.nodeValue = item.textContent;
                });
            });
        })(DivSearch);
    })();   
</script>


<!--SETUP Jquery grid-->
<!-- The jQuery library is a prerequisite for all jqSuite products -->
<script>window.jQuery || NA.common.doc.write('\<script src="\.\.\/\.\.\/\.\.\/static\/app\/scripts\/jquery\-1\.11\.1\.js"\>\<\/script\>')</script>

<!-- This is the Javascript file of jqGrid -->
<script src="../../../static/app/scripts/jquery.jqGrid.js"></script>

<!-- This is the localization file of the grid controlling messages, labels, etc. -->
<!-- We support more than 40 localizations -->
<script src="../../../static/app/scripts/jqGridJS/i18n/grid.locale-en.js"></script>
<!----------------------------Load Jquery UI. JS file-------------------------------->
<scriptS src="../../../static/app/scripts/jquery-ui.js"></scriptS>
<script src="../../../static/app/scripts/bootstrap-dialog.js"></script>
{% endblock %}

{%block content-0 %}
<table id="jqGrid_NA_F_Goods_Receive"></table>
<div id="jqGrid_NA_F_Goods_Receive_Pager"></div>

{%endblock%}

{% block DialogEntry %}
<script type="text/javascript">
	//=================================AJAX Setup===========================-->

	(function () {
		$.ajaxSetup({
			cache: false,
			error: function (xhr, status, error) {
				try {
					var messageErr = xhr.responseText;
					var contentype = xhr.getResponseHeader('Content-Type')
					if (contentype === 'application/json') {
						messageErr = $.parseJSON(xhr.responseText);
					}
					var message = xhr.responseText;
					if (messageErr) {
						message = messageErr.message;
					}
					if (message) {
						alert('An error occurred: ' + error + '\n' + xhr.status + ": " + message);
					}

				} catch (e) {
					alert('An error occurred: ' + error + '\n' + xhr.status + ": " + e.message);
				}
				window.document.body.style.cursor = 'defautl'; return false;
			},
			timeout: 2000000, // Timeout// nanti kalau sudah selesai system timeout ini harus di rubah, jadi maximal 20 detik
			type: 'GET',
			crossDomain: false, // obviates need for sameOrigin test                              
		});

		//===================================END AJAX SetuP===========================--> 

		//========================Variable Object untuk ===============================
		var win = win || window,
        grid = $("#jqGrid_NA_F_Goods_Receive"),
        txtSearchMaster = txtSearchMaster || NA.common.doc.querySelector('form.navbar-form div.input-group input[name="q"]'),
        btnSearchMaster = btnSearchMaster || NA.common.doc.querySelector('form.navbar-form button[type="submit"].btn.btn-default'),
        status = status || win.status, csrftoken = function () { return NA.CookieUtil.get('csrftoken'); }, initializeForm = '',
        //settings btn sesuai user access
        //anggap saja sekarang admin
        btnSave = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(4)'),
        btnDelete = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(5)'),
        btnExport = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(6)'),
        btnPrint = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(7)'),
        btnHelp = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(8)'),
        containerMenu = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav');//inistialisasi menu 

		window.onunload = function () {
			if (typeof txtSearchMaster.onclick == "function") {
				NA.NAEvent.removeHandler(txtSearchMaster, 'keydown', handlerSearchInput)
			}
			if (typeof btnSearchMaster.onclick == "function") {
				NA.NAEvent.removeHandler(btnSearchMaster, 'click', handlerSearchInput);
			}
		};
		function LoadData(page) {
			var url = 'NA_Goods_Receive_Search/?' + win.encodeURIComponent('columnName') + '=' + win.encodeURIComponent(NA.common.SearchData.getColumnKey()) +
                      '&' + win.encodeURIComponent('valueKey') + '=' + win.encodeURIComponent(NA.common.SearchData.getValueKey()) +
                      '&' + win.encodeURIComponent('dataType') + '=' + win.encodeURIComponent(NA.common.SearchData.getDataType()) +
                      '&' + win.encodeURIComponent('criteria') + '=' + win.encodeURIComponent(NA.common.SearchData.getCriteria());
			if (arguments.length > 0) {
				grid.setGridParam({ url: url }).trigger("reloadGrid", [{ page: page, }]);
			}
			else {
				try {
					grid.jqGrid({
						url: url,
						mtype: "GET",
						datatype: "json",//column IDapp, NO,	goods 	datereceived supliername FK_ReceivedBy 	Received_By FK_P_R_By pr_by totalpurchased totalreceived 
						colNames: ['IDapp', 'NO', 'goods Description', 'Date Received', 'Suplier Name', 'FK_ReceivedBy', 'Received By', 'FK_P_R_By ', 'Purchase Request By', 'Total Purchased', 'Total Received', 'Created Date', 'Created By'],
						colModel: [
                            { name: 'idapp', key: true, hidden: true, align: 'left' },
                            { name: 'NO', width: 50, align: 'right', sortable: false, editable: false, },
                            { name: 'goods', index: 'itemcode', width: 140, sortable: true, editable: false, align: 'left', },
                            { name: 'datereceived', index: 'datereceived', sortable: true, width: 120, formatter: 'date', formatoptions: { srcformat: 'Y-m-d', newformat: 'd F Y' } },
                            { name: 'supliername', index: 'supliername', width: 150, sortable: true, editable: false, align: 'left', },
                            //formatter : 'date', formatoptions: { srcformat : 'Y-m-d H:i:s', newformat :'ShortDate'}},
                            { name: 'FK_ReceivedBy', index: 'FK_ReceivedBy', hidden: true, },
                            { name: 'Received_By', index: 'Received_By', width: 120, sortable: true, editable: false, align: 'left', },
                            { name: 'FK_P_R_By', index: 'FK_ReceivedBy', hidden: true, },
                            { name: 'pr_by', index: 'pr_by', width: 120, sortable: true, editable: false, align: 'left', },
                            {
                            	name: 'totalpurchased', index: 'totalpurchased', width: 100, sortable: true, align: 'right', formatter: 'currency', formatoptions: {
                            		decimalSeparator: ",", thousandsSeparator: ".", decimalPlaces: 2, prefix: "Rp "
                            	},
                            },
                            {
                            	name: 'totalreceived', index: 'totalreceived', width: 100, sortable: true, align: 'right', formatter: 'currency', formatoptions: {
                            		decimalSeparator: ",", thousandsSeparator: ".", decimalPlaces: 2, prefix: "Rp "
                            	},
                            },
                            { name: 'createddate', index: 'CreatedDate', sortable: true, width: 120, formatter: 'date', formatoptions: { srcformat: 'Y-m-d', newformat: 'd F Y' } },
                            { name: 'reatedby', index: 'CreatedBy', sortable: true, width: 110, editable: false, },
						],
						ondblClickRow: function (rowId) {
							var btnOpen = NA.common.doc.querySelector('ul.nav.navbar-nav>li:nth-child(2)>button');
							if (btnOpen) {
								btnOpen.click();
							}
						},
						gridComplete: function () {
							document.body.style.cursor = 'default';
						},
						cellEdit: false,
						viewrecords: true,
						height: $('div.fltlft').height() - ($('div.fltlft').height() * 0.173),
						rowNum: 300,
						rowList: [20, 50, 100, 200, 300, 500],
						sortname: "idapp",
						sortorder: "desc",
						multiSort: true,
						shrinkToFit: false,
						iconSet: "fontAwesome",
						forceFit: true,
						toolbar: true,
						scrollrows: true,
						hidegrid: true,
						caption: "Transactions ---Goods Received",
						pager: "#jqGrid_NA_F_Goods_Receive_Pager"
					});
					grid.navGrid("#jqGrid_NA_F_Goods_Receive_Pager", {
						search: false, // show search button on the toolbar
						add: false,
						edit: false,
						del: false,
						refresh: true
					});

				} catch (e) {
					alert(e.message);
					console.log(e);
					document.body.style.cursor = 'default';
				}
			};
		};

		var SearchData = NA.common.SearchData;
		SearchData.setDefaultSearchData('goods', 'varchar', 'like');
		LoadData();

		NA.common.doc.title = 'Entry Data Goods Receive';
		//disablekan save dan help karena saat ini tidak di pakai
		btnSave.setAttribute('disable', true);
		btnHelp.setAttribute('disable', true);

		NA.common.dialog.initDialog(containerMenu, 'Nufarm Entry Goods - Master Data');//inistialisasi menu     

		//====================GROUP FUNCTION DECLARATION===============================


		function getGridCellValue(thegrid,CeltoGet) {
			var reccount = thegrid.jqGrid('getGridParam', 'reccount');
			var rowId, rowData, colData;
			if (reccount > 0) {
				rowId = thegrid.jqGrid('getGridParam', 'selrow');
				if (rowId) {
					rowData = thegrid.getRowData(rowId);
					colData = rowData[CeltoGet];
				}
			}
			return colData;
		};
		//csrf token untuk form
		function csrfSafeMethod(method) {
			// these HTTP methods do not require CSRF protection
			return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
		};
		//========================END GROUP FUNCTION DECLARATION===================================


		//=======================GROUP FUNCTION EVENT=============================================
		function printToPDF(event) {
			if (event) {
				NA.NAEvent.preventDefault(event);
				var target = NA.NAEvent.getTarget(event);
				grid.jqGrid("exportToPdf", {
					title: 'Transactions -- goods Received',
					orientation: 'portrait',
					pageSize: 'A4',
					description: 'description of the exported document',
					customSettings: null,
					download: 'download',
					includeLabels: true,
					includeGroupHeader: true,
					includeFooter: true,
					fileName: "goods_Received.pdf"
					//langsung print by pdf file
				});
			}
		};

		function ExporttoExcel(event) {
			if (event) {
				NA.NAEvent.preventDefault(event);
				grid.jqGrid("exportToExcel", {
					includeLabels: true,
					includeGroupHeader: true,
					includeFooter: true,
					fileName: "goods_Received.xlsx",
					maxlength: 40 // maxlength for visible string data 
				});
				NA.NAEvent.stopPropagation(event);
			}
		};
		//set eventKeyboard di search textbox
		function handlerSearchInput(event) {
			event = NA.NAEvent.getEvent(event);
			if (event.keyCode === 13 || event.target == btnSearchMaster) {
				NA.NAEvent.preventDefault(event);
				var elSearch = NA.common.doc.querySelector('li.dropdown>a#bySearch'),
                SearchBy = NA.common.doc.querySelector('li.dropdown>a#bySearch').textContent.trim();
				if (SearchBy.trim() == 'By') {
					NA.common.SearchData.setDefaultSearchData('goodsname', 'Varchar', 'like');
					var curPage = parseInt(grid.getGridParam('page'));
					window.document.body.style.cursor = 'wait';
					if (event.target.value !== '') {
						NA.common.SearchData.setValue(event.target.value);
					}
					LoadData(curPage);
				}
				else {
					//submit search
					submitSearch(event);
				}
				NA.NAEvent.stopPropagation(event);
			}
			window.document.body.style.cursor = '';
		};
		function submitSearch(event) {
			window.document.body.style.cursor = 'wait';
			if (event)
				NA.NAEvent.preventDefault(event);

			var elementOption = null, columnKey = '', valueKey = '',
            elCriteria = null,//NA.common.doc.querySelector('td.columns select.selectopts.NA-Form-Control option:checked');
            valCriteria = '',//elCriteria.nodeValue;
            elDataType = '';//elementOption.dataset.dataType;
			//get  ajax with querystring search
			//valueKey : valueKey,
			//columnKey :columnKey,
			//dataType : dataType,
			//criteria : criteria,
			if (event.target.getAttribute('id') === 'fbox_jqGrid_search' || event.target.getAttribute('id') === 'jqg1') {//fbox_jqGrid_search == button search,jqg1 = txtSearch nya
				elementOption = NA.common.doc.querySelector('td.columns select.NA-Form-Control option:checked');
				columnKey = elementOption.getAttribute('name'), valueKey = NA.common.getElementID('jqg1').value;
				elCriteria = NA.common.doc.querySelector('td.operators select.selectopts.NA-Form-Control option:checked');
				criteria = elCriteria.value;
				switch (valCriteria) {
					case "eq": { criteria = 'equal'; break; }
					case "ne": { criteria = 'not equal'; break; }
					case "bw": { criteria = 'beginwith'; break; }
					case "ew": { criteria = "endwith"; break; }
					case "cn": { criteria = "contains"; break; }
					case "in": { criteria = "in"; break; }
					case "ni": { criteria = "notin"; break; }
					case "gt": { criteria = "Greater"; break; }
					case "le": { criteria = "less"; break; }
					case "leq": { criteria = "lessorequal"; break; }
					case "gtq": { criteria = "greaterorequal"; break; }
					case "bw": { criteria = "between"; break; }
				};
				elDataType = elementOption.dataset.tipe;
			}
			else if (event.target == txtSearchMaster || event.target == btnSearchMaster) {
				var txtSearchMaster = txtSearchMaster || NA.common.doc.querySelector('form.navbar-form div.input-group input[name="q"]'),
                elSearch = null;
				valueKey = txtSearchMaster.value.trim();
				var listElem = NA.common.doc.querySelector('ul.dropdown-menu.search').children;//return list Element
				var textToSearch = NA.common.getElementID('bySearch').firstChild.nodeValue;
				Array.prototype.forEach.call(listElem, function (item) {//buat jadi foreach mesti convert dulu ke array                   
					if (item.firstChild.textContent === textToSearch) {
						elSearch = item.firstChild;
					}
				});
				columnKey = elSearch.dataset.column
				elDataType = elSearch.dataset.tipe;
				criteria = 'like'
				if (!elSearch.dataset.column) {
					switch (elDataType) {
						case "bigint":
						case "integer":
						case "money":
						case "float":
						case "decimal":
						case "boolean":
						case "datetime": {
							if (valueKey.toString().indexOf(',') > -1) {
								criteria = 'in'
							}
							criteria = 'equal';
							break;
						}
					};
				}
			};

			NA.common.SearchData.setValue(valueKey);
			NA.common.SearchData.setColumnName(columnKey);
			NA.common.SearchData.setDataType(elDataType)
			NA.common.SearchData.setCriteria(valCriteria);
			window.document.body.style.cursor = 'wait';
			LoadData(1);
			document.body.style.cursor = 'default';
			//grid.setGridParam.trigger("reloadGrid",[{page:1}]);//karena searching harus di set ke page 1
		};

		//function untuk Reset
		function submitReset(event) {
			window.document.body.style.cursor = 'wait';
			NA.common.SearchData.setDefaultSearchData('goods', 'varchar', 'like');
			NA.common.SearchData.setValue('');
			LoadData(1);
			window.document.body.style.cursor = 'default';
		};

		//=======================END GROUP FUNCTION EVENT========================================


		//=======================GROUP ASSINGED HANDLER ========================================= 
		//assign delete key event
		grid.on("keyup", "tr", function (e) {
			//var rowid = parseInt($(this).attr("id"));
			var rowId = grid.jqGrid('getGridParam', 'selrow');
			if (e.keyCode == 46) {
				var btnDelete = NA.common.dialog.doc.querySelector('ul.nav.navbar-nav li:nth-child(5)')
				btnDelete.click();
				return false;
			}
		});

		//=======================handler txt & button Search master keyboard event and click================================        
		NA.NAEvent.addHandler(txtSearchMaster, 'keydown', handlerSearchInput);
		NA.NAEvent.addHandler(btnSearchMaster, 'click', handlerSearchInput);
		//=========================================================================================     

		NA.NAEvent.addHandler(btnDelete, 'click', function (event) {
			var IDApp = getGridCellValue(grid,'IDApp');
			if (IDApp) {
				NA.NAEvent.preventDefault(event);
				if (!confirm('are you sure you want to delete data\nOperation can not be undone ?')) {
					return false;
				}
				NA.NAEvent.preventDefault(event);
				try {
					//delete data di server                  
					//$(selector).post(URL,data,function(data,status,xhr),dataType)-->return data type
					var url = NA.common.addURLParam('Delete/', 'itemCode', itemCode);
					$.post(url, {}, function (data, textStatus, jqXHR) {
						if (textStatus === 'success') {
							var rowNum = grid.getGridParam('rowNum'),
                         allRecords = grid.getGridParam('records'),
                         totalPages = parseInt((allRecords / rowNum) + 1),
                         curPage = grid.getGridParam('page'),
                         rowId = grid.jqGrid('getGridParam', 'selrow'),
                            curRecount = grid.jqGrid('getGridParam', 'reccount');
							mustReload = true;
							if (parseInt(curRecount) === 1) {
								if (totalPages > 1) {
									curPage--;
								}
								else {
									mustReload = false;
									grid.delRowData(rowId);
								}
							}
							else if (parseInt(totalPages) === 1) {
								mustReload = false;
								grid.delRowData(rowId);
							}
							else if (parseInt(curRecount) > 1) {
								mustReload = false;
								grid.delRowData(rowId);
							}
							if (mustReload) {
								window.document.body.style.cursor = 'wait';
								grid.trigger("reloadGrid", [{ page: curPage }]);
							}
						}
					});
				} catch (e) {
					console.log(e);
					window.document.body.style.cursor = 'default';
					if (JSON.parse(e.message)) {
						alert(e.name + ': ' + JSON.parse(e.message));
					}
					else {
						alert(e);
					}
				}
			}
			else {
				document.body.style.cursor = 'default';
				alert('Please select data you want to delete');
			}
			return false;
		});
		NA.NAEvent.addHandler(btnExport, 'click', ExporttoExcel);
		NA.NAEvent.addHandler(btnPrint, 'click', printToPDF);
		//======================END GROUP ASSINGED HANDLER =========================================

		//======================GROUP DIALOG ENTRY==================================================
		window.showDialogEntry = function (event) {//function ini akan di panggil oleh NAJS.common.dialog,setiap menu add/edit/delete,etc di clik 
			//add handler to btnOK untuk mengantisipasi form load gagal
			var dialog = NA.common.dialog.doc.querySelector("div.containerDialog"),
        	   btnOKCancel = NA.NAEvent.doc.querySelectorAll('div.dialogButtonOKCancel>a.button'),
			   btnClose = NA.common.dialog.doc.querySelector('button.ui-button.ui-dialog-titlebar-close');
			Array.prototype.forEach.call(btnOKCancel, function (item) {//buat jadi foreach mesti convert dulu ke array
				NA.NAEvent.addHandler(item, 'click', function (event) {
					NA.NAEvent.preventDefault(event);
					ExecuteHandler(event.target.value);
					var curPage = grid.getGridParam('page')
					grid.trigger("reloadGrid", [{ page: 1 }]);
					if (event) {
						NA.NAEvent.stopPropagation(event);
					} document.body.style.cursor = 'default';
					return false;
				});
			});
			NA.NAEvent.addHandler(btnClose, 'click', function (event) {
				NA.NAEvent.preventDefault(event);
				ExecuteHandler('Close');
				NA.common.dialog.closeDialog(dialog);
				if (event) {
					NA.NAEvent.stopPropagation(event);
				}
				document.body.style.cursor = 'default';
				return false;
			});
			try {
				var target = NA.NAEvent.getTarget(event);
				if (target.innerText === ' Add' || target.innerText === ' Edit' || target.innerText === ' Open') {
					if (target.innerText.trim() !== 'Add') {
						var IDApp = getGridCellValue(grid,'IDApp');
						if (typeof IDApp == 'undefined' || IDApp === '') {
							alert('Please select data to edit');
							var dialog = dialog || NA.common.dialog.doc.querySelector("div.containerDialog");
							if (dialog) {
								NA.common.dialog.closeDialog(dialog);
							}
							if (document.body.style.cursor != 'default') { document.body.style.cursor = 'default'; }
							return false;
						}
					}
					$('div.maindialogContent').load("ShowEntry_Receive?" + win.encodeURIComponent('IDApp') + '=' + win.encodeURIComponent(IDApp) +
                        '&' + win.encodeURIComponent('status') + '=' + win.encodeURIComponent(target.innerText.trim()), function (responseTxt, statusTxt, xhr) {//load /tampilkan form entry data                    

                        	if (statusTxt == "success") { //jika form sudah di load selanjutnya tinggal inisialisasi semua component dan simpang semua ke dalam variable jika perlua

                        		$(this).html(responseTxt);
                        		//remove attribute disable untuk button OK dan cancel bila statusnya Add
								//fk_goods daterecieved fk_suplier totalpurchase totalrecieved  fk_receivedby fk_p_r_by
                        		status = status || win.status || target.innerText.trim();
                        		switch (status) {
                        			case 'Add': {
                        				//if(hasAttribute("value
                        				if (target.hasAttribute('disabled')) {
                        					target.removeAttribute('disabled');
                        				}
                        				break;
                        			}
                        			case 'Edit': {
                        				NA.common.getElementID('id_itemcode').disabled = true;
                        				break;
                        			}
                        			case 'Open': {
                        				Array.prototype.forEach.call(NA.common.doc.querySelectorAll('div.dialogButtonEntry>a.button'), function (item) {
                        					if (!item.hasAttribute('disabled')) {
                        						item.setAttribute('disabled', true);
                        					}
                        				});
                        				//matikan FK_goods,fk_suplier,fk_received_by,fk_p_r_by

                        				break;
                        			}
                        		};
                        		if (status !== 'Open' && status !== '') {//hanya untuk status Add/Edit                                   
                        			//simpan original data di initializeForm
                        			var originalData = JSON.stringify(getValuesForm());
                        			//$('#id_initializeForm').val(originalData);
                        			initializeForm = NA.common.getElementID('id_initializeForm');
                        			initializeForm.Value = originalData;
                        			//========set autocomplete buat brand============
                        			$("#id_brandname").autocomplete({ source: "SearchBrand/", minLength: 1, });
                        			//tambahkan css untuk autocomplete file agar munculnya dengan backgorund bisa menutupi layer 1
                        			NA.common.doc.querySelector('ul[id*="ui-id-"]').style.backgroundColor = 'white';                        			//setting focus dan blur

                        			Array.prototype.forEach.call(NA.common.doc.querySelectorAll('input[type="text"]'),function (item) {
                        				var valPlaceHolder = item.dataset.value;
                        				NA.NAEvent.addHandler(item, 'focus', function (event) {
                        					if (this.value === '') {
                        						if (this.getAttribute('placeholder') === valPlaceHolder) {
                        							this.setAttribute('placeholder', '');
                        						}
                        					}
                        				});
										//============blur event================================
                        				NA.NAEvent.addHandler(item, 'blur', function (event) {
                        					if (this.value === '') {
                        						if (this.getAttribute('placeholder') === '') {
                        							this.setAttribute('placeholder', valPlaceHolder);
                        						}
                        					}
                        				});
                        				NA.NAEvent.addHandler(item, 'keydown', function (event) {
                        					if (event.keyCode === 13) {//kalau menekan tombol enter
                        						switch (this.id) {
                        							case 'id_fk_goods': {
                        								//prevent default
                        								NA.NAEvent.preventDefault(event);//prevent from submit
														//get data ke database by itemCode
                        								//jika ada tampilkan data di form goods_desc
                        								break;
                        							}
                        							case 'id_fk_suplier': {

                        								//jika ada tampilkan data di form supliername
                        								break;
                        							}
                        							case 'id_fk_receivedby': {

                        								//jika ada tampilkan data di form employee_Received
                        								break;
                        							}
                        							case 'id_fk_p_r_by': {

                        								//jika ada tampilkan data di form employee_pr
                        								break;
                        							}
                        						}
                        					}
                        				});
                        			});
                        			//====================id_daterecieved===========================
                        			//set JQueryDatePicker
                        			$('#id_daterecieved').datepicker({ dateFormat: 'dd/mm/yyyy' });
                        			//setting Custom Validity
                        			var elm = NA.common.doc.querySelector('#id_daterecieved');
                        			NA.NAEvent.addHandler(elm, 'input', function (event) {
                        				var elpat = this.getAttribute('patern');
                        				var patern = new RegExp(elpat, 'i');
                        				var valuePat = this.value;
                        				if (valuePat === null || valuePat === '') {
                        					valuePat = this.textcontent;
                        				}
                        				if (!patern.test(valuePat)) {
                        					this.setCustomValidity('Invalid date value');
                        					this.validity.valid = false;
                        				}
                        				else {
                        					this.setCustomValidity(''); //clearkan error custom validity
                        				}
                        			});
                        			//=====================end id_daterecieved==========================================

                        			//fk_goods daterecieved fk_suplier totalpurchase totalrecieved  fk_receivedby fk_p_r_by
									//======================BUTTONS Search================================================
                        			//add event to btn Find goods
                        			var btnFindGoods = NA.common.doc.querySelector('div.NA-Entry-div-row button#FE_fk_goods'),
										btnFindSuplier = NA.common.doc.querySelector('div.NA-Entry-div-row button#FE_fk_suplier'),
										btnFindPRBy = NA.common.doc.querySelector('div.NA-Entry-div-row button#FE_fk_pr_by'),
										btnFindReceivedBy = NA.common.doc.querySelector('div.NA-Entry-div-row button#FE_fk_receivedby');
                        			NA.NAEvent.addHandler(btnFindGoods, 'click', function (event) {
										//create bootstrapDialog
                        				BootstrapDialog.show({

                        					//message: (function () {
                        					//	//==============create formSearching===============
                        					//	//create div for container
                        					//	//create header div for searching
                        					//	//create div for main container
                        					

                        					//	//if success , set event on double click, set event to button OK
                        					//})(this),
                        					message: function (dialogRef) {
                        						var placeHolder = 'Enter goods desc to search for';
                        						var gridTbl = null, gridPager = null;                        						
												var containerMessage = NA.common.dialog.createFormContainer('fk_goods', placeHolder,
												function (e) {//event for blur
													if (this.value === '') {
														if (this.getAttribute('placeholder') === '') {
															this.setAttribute('placeholder', placeHolder);
														}
													}
												},
												function (e) {//event for focus
													if (this.value === '') {
														if (this.getAttribute('placeholder') === 'Enter goods desc to search for') {
															this.setAttribute('placeholder', '');
														}
													}
												},
												function (e) {//even for keydown txtSearch
													if (e.keyCode === 13) {
														win.document.body.style.cursor = 'wait';
														//cari data ke database
														var url = '/SearchGoodsbyForm?' + win.encodeURIComponent('goods_desc') + '=' + win.encodeURIComponent(e.target.value.trim());
														//var ajax = NA.common.AJAX();
														//ajax.GET(url, 'application/json', null, function () {
														//	window.document.body.style.cursor = 'wait';
														//}, function (xhr) {
														//	if (xhr.status == 200 && xhr.status < 300) {
														//		var json = JSON.parse(xhr.responseText);
														//		//reloadJquery
														//	}
														//}, null, function (xhr) {

														//}, OnLoadEnd, customRequestHeader);
														if (gridTbl) {
															gridTbl.setGridParam({ url: url }).trigger("reloadGrid", [{ page: page, }]);
														}
														win.document.body.style.cursor = 'default';
													}
												});
												var children = containerMessage.childNodes;
												var mainContainer = null, txtSearch = null;
												for (var i = 0, len = children.length; i < len; i++) {
													if (children[i].nodeType == 1 && children[i].className === 'maincontainerForm') {
														mainContainer = children[i];
													}
													//else if (children[i].nodeType == 1 && children[i].className === 'NA-Entry-div-row') {
													//	txtSearch = children[i].childNodes[0];
													//}
													break;
												}
												var txtSearch = NA.common.getElementID('txtsearch_fk_goods');
												if (mainContainer && txtSearch) {
													//loads Data into JqueryGrid
													var gridTbl = NA.common.doc.createElement('table');
													gridTbl.id = 'jqGrid_NA_F_Goods_Receive_FK_Goods';
													var gridPager = NA.common.doc.createElement('div');
													gridPager.id = 'jqGrid_NA_F_Goods_Receive_FK_Goods_Pager';

													var urlFKGoods = 'NA_F_Goods_Receive_FK_Goods/?' + win.encodeURIComponent('searchText') + '=' + win.encodeURIComponent(txtSearch.textContent.trim());
													gridTbl.jqGrid({
														url: urlFKGoods,
														mtype: "GET",
														datatype: "json",//column IDapp, NO,	goods 	datereceived supliername FK_ReceivedBy 	Received_By FK_P_R_By pr_by totalpurchased totalreceived 
														colNames: ['IDapp', 'NO', 'itemcode', 'goods Description', ],
														colModel: [
															{ name: 'idapp', key: true, hidden: true, align: 'left' },
															{ name: 'NO', width: 50, align: 'right', sortable: false, editable: false, },
															{ name: 'itemcode', width: 80, align: 'left', sortable: true, editable: false, },
															{ name: 'goods', index: 'goods', width: 150, sortable: true, editable: false, align: 'left', },
														],
														ondblClickRow: function (rowId) {
															//fire button OK
															var btnOK = dialogRef.getButton('btnOKFindGoods');
															btnOK.click();
														},
														gridComplete: function () {
															document.body.style.cursor = 'default';
														},
														cellEdit: false,
														viewrecords: true,
														height: '500px',
														rowNum: 500,
														rowList: [20, 50, 100, 200, 300, 500],
														sortname: "itemcode",
														sortorder: "asc",
														multiSort: true,
														shrinkToFit: false,
														iconSet: "fontAwesome",
														forceFit: true,
														toolbar: true,
														scrollrows: true,
														hidegrid: true,
														caption: "Transactions ---Find goods",
														pager: "#jqGrid_NA_F_Goods_Receive_FK_Goods_Pager"
													});
													gridTbl.navGrid(gridPager, {
														search: false, // show search button on the toolbar
														add: false,
														edit: false,
														del: false,
														refresh: false
													});
													containerMessage.childNodes[mainContainer].appendChild(gridTbl);
													containerMessage.childNodes[mainContainer].appendChild(gridPager);
												}												
												return containerMessage;
                        					},
                        					closable: true,
                        					closeByBackdrop: false,
                        					closeByKeyboard: false,
                        					buttons: [{
                        						label: 'Cancel',
                        						icon: 'glyphicon glyphicon-remove',
                        						cssClass : 'btn-success',
                        						action: function (dialogRef) {
                        							dialogRef.close();
                        						},
                        					}, {
                        						label: 'OK',
												id:'btnOKFindGoods',
                        						icon: 'glyphicon glyphicon-ok',
                        						cssClass: 'btn-success',
                        						action: function (dialogRef) {
                        							var IDApp = getGridCellValue(gridTbl, 'IDApp');
                        							if (IDApp) {//cell di select sama user
                        								//tempelkan data row di fk_goods, dan valuenya di goods_desc;
                        							var rowId = gridTbl.jqGrid('getGridParam', 'selrow');
                        							var rowData = gridTbl.getRowData(rowId);
                        							var fk_Goods = rowData['itemcode'], goods_Desc = rowData['goods'];
                        							var txtid_fk_goods = NA.common.getElementID('id_fk_goods');
                        							txtid_fk_goods.textContent = fk_Goods;
                        							var txtgoodsDesc = NA.common.getElementID('id_goods_desc');
                        							txtgoodsDesc.textContent = goods_Desc;
                        							}
                        						}
                        					}]
                        				});                        				
                        			});
                        			NA.NAEvent.addHandler(btnFindSuplier, 'click', function (event) {
                        				//create bootstrapDialog
                        				BootstrapDialog.show({

                        					//message: (function () {
                        					//	//==============create formSearching===============
                        					//	//create div for container
                        					//	//create header div for searching
                        					//	//create div for main container


                        					//	//if success , set event on double click, set event to button OK
                        					//})(this),
                        					message: function (dialogRef) {
                        						var placeHolder = 'Enter Suplier name to search for';
                        						var gridTbl = null, gridPager = null;
                        						var containerMessage = NA.common.dialog.createFormContainer('fk_suplier', placeHolder,
												function (e) {//event for blur
													if (this.value === '') {
														if (this.getAttribute('placeholder') === '') {
															this.setAttribute('placeholder', placeHolder);
														}
													}
												},
												function (e) {//event for focus
													if (this.value === '') {
														if (this.getAttribute('placeholder') === 'Enter suplier name to search for') {
															this.setAttribute('placeholder', '');
														}
													}
												},
												function (e) {//even for keydown txtSearch
													if (e.keyCode === 13) {
														win.document.body.style.cursor = 'wait';
														//cari data ke database
														var url = '/SearchSuplierbyForm?' + win.encodeURIComponent('supliername') + '=' + win.encodeURIComponent(e.target.value.trim());
														//var ajax = NA.common.AJAX();
														//ajax.GET(url, 'application/json', null, function () {
														//	window.document.body.style.cursor = 'wait';
														//}, function (xhr) {
														//	if (xhr.status == 200 && xhr.status < 300) {
														//		var json = JSON.parse(xhr.responseText);
														//		//reloadJquery
														//	}
														//}, null, function (xhr) {

														//}, OnLoadEnd, customRequestHeader);
														if (gridTbl) {
															gridTbl.setGridParam({ url: url }).trigger("reloadGrid", [{ page: page, }]);
														}
														win.document.body.style.cursor = 'default';
													}
												});
                        						var children = containerMessage.childNodes;
                        						var mainContainer = null, txtSearch = null;
                        						for (var i = 0, len = children.length; i < len; i++) {
                        							if (children[i].nodeType == 1 && children[i].className === 'maincontainerForm') {
                        								mainContainer = children[i];
                        							}
                        							//else if (children[i].nodeType == 1 && children[i].className === 'NA-Entry-div-row') {
                        							//	txtSearch = children[i].childNodes[0];
                        							//}
                        							break;
                        						}
                        						var txtSearch = NA.common.getElementID('txtsearch_fk_suplier');
                        						if (mainContainer && txtSearch) {
                        							//loads Data into JqueryGrid
                        							var gridTbl = NA.common.doc.createElement('table');
                        							gridTbl.id = 'jqGrid_NA_F_Goods_Receive_fk_suplier';
                        							var gridPager = NA.common.doc.createElement('div');
                        							gridPager.id = 'jqGrid_NA_F_Goods_Receive_fk_suplier_Pager';

                        							var urlFKGoods = 'NA_F_Goods_Receive_fk_suplier/?' + win.encodeURIComponent('searchText') + '=' + win.encodeURIComponent(txtSearch.textContent.trim());
                        							gridTbl.jqGrid({
                        								url: urlFKGoods,
                        								mtype: "GET",
                        								datatype: "json",//column IDapp, NO,	goods 	datereceived supliername FK_ReceivedBy 	Received_By FK_P_R_By pr_by totalpurchased totalreceived 
                        								colNames: ['IDapp', 'NO', 'supliercode', 'suplier name', ],
                        								colModel: [
															{ name: 'idapp', key: true, hidden: true, align: 'left' },
															{ name: 'NO', width: 50, align: 'right', sortable: false, editable: false, },
															{ name: 'supliercode', width: 90, align: 'left', sortable: true, editable: false, },
															{ name: 'supliername', index: 'supliername', width: 150, sortable: true, editable: false, align: 'left', },
                        								],
                        								ondblClickRow: function (rowId) {
                        									//fire button OK
                        									var btnOK = dialogRef.getButton('btnOKFindsuplier');
                        									btnOK.click();
                        								},
                        								gridComplete: function () {
                        									document.body.style.cursor = 'default';
                        								},
                        								cellEdit: false,
                        								viewrecords: true,
                        								height: '500px',
                        								rowNum: 500,
                        								rowList: [20, 50, 100, 200, 300, 500],
                        								sortname: "supliername",
                        								sortorder: "asc",
                        								multiSort: true,
                        								shrinkToFit: false,
                        								iconSet: "fontAwesome",
                        								forceFit: true,
                        								toolbar: true,
                        								scrollrows: true,
                        								hidegrid: true,
                        								caption: "Transactions ---Find suplier",
                        								pager: "#jqGrid_NA_F_Goods_Receive_fk_suplier_Pager"
                        							});
                        							gridTbl.navGrid(gridPager, {
                        								search: false, // show search button on the toolbar
                        								add: false,
                        								edit: false,
                        								del: false,
                        								refresh: false
                        							});
                        							containerMessage.childNodes[mainContainer].appendChild(gridTbl);
                        							containerMessage.childNodes[mainContainer].appendChild(gridPager);
                        						}
                        						return containerMessage;
                        					},
                        					closable: true,
                        					closeByBackdrop: false,
                        					closeByKeyboard: false,
                        					buttons: [{
                        						label: 'Cancel',
                        						icon: 'glyphicon glyphicon-remove',
                        						cssClass: 'btn-success',
                        						action: function (dialogRef) {
                        							dialogRef.close();
                        						},
                        					}, {
                        						label: 'OK',
                        						id: 'btnOKFindsuplier',
                        						icon: 'glyphicon glyphicon-ok',
                        						cssClass: 'btn-success',
                        						action: function (dialogRef) {
                        							var supliercode = getGridCellValue(gridTbl, 'supliercode');
                        							if (supliercode) {//cell di select sama user
                        								//tempelkan data row di fk_goods, dan valuenya di goods_desc;
                        								var rowId = gridTbl.jqGrid('getGridParam', 'selrow');
                        								var rowData = gridTbl.getRowData(rowId);
                        								var fk_suplier = rowData['supliercode'], supliername = rowData['supliername'];
                        								var txtid_fk_suplier = NA.common.getElementID('id_fk_suplier');
                        								txtid_fk_suplier.textContent = supliercode;
                        								var txtsupliername = NA.common.getElementID('id_supliername');
                        								txtsupliername.textContent = supliername;
                        							}
                        						}
                        					}]
                        				});
                        			});
                        			NA.NAEvent.addHandler(btnFindPRBy, 'click', function (event) {

                        			});
                        			NA.NAEvent.addHandler(btnFindReceivedBy, 'click', function (event) {

                        			});
                        		}
                        	}
                        	NA.NAEvent.preventDefault(event);
                        	if (document.body.style.cursor != 'default') { document.body.style.cursor = 'default'; }
                        });
				}
				//else if(target.innerText === ' Employee'){
				//    alert('employee load');
				//    return false;
				//}                
			} catch (e) {
				dialog = NA.common.dialog.doc.querySelector("div.containerDialog");
				if (dialog) {
					NA.common.dialog.closeDialog(dialog);
				}
				if (document.body.style.cursor != 'default') { document.body.style.cursor = 'default'; }
				alert(e);
			}
		};
	})();
</script>
{% endblock %}